В этом упражнении мы продолжим работу с примером, в котором компания разрабатывает средства администрирования Linux. Если помните, вы планируете использовать виртуальные машины Linux, чтобы позволить потенциальным клиентам тестировать ваше программное обеспечение. У вас есть готовая группа ресурсов, и теперь нужно создать виртуальную машину.

Ваша компания оплатила стенд на большой выставке-ярмарке по Linux. Вы планируете использовать демонстрационную область, содержащую три терминала, каждый из которых подключен к отдельной виртуальной машине Linux. В конце каждого дня требуется удалять эти виртуальные машины и создавать их заново, чтобы каждое утро они находились в исходном состоянии. Если заниматься созданием виртуальных машин вручную после работы, когда вы уже устали, это с высокой вероятностью приведет к ошибкам. Вы хотите написать сценарий PowerShell, позволяющий автоматизировать создание виртуальных машин.

## <a name="write-a-script-that-creates-virtual-machines"></a>Создание сценария, создающего виртуальные машины

Чтобы создать сценарий, сделайте следующее:

1. Создайте текстовый файл с именем **ConferenceDailyReset.ps1**.

2. Запишите параметр в переменную:

    ```powershell
    param([string]$resourceGroup)
    ```

3. Выполните проверку подлинности в Azure, используя свои учетные данные:

    ```powershell
    Connect-AzureRmAccount
    ```

4. Запросите имя пользователя и пароль для учетной записи администратора виртуальной машины и сохраните результат в переменной:

    ```powershell
    $adminCredential = Get-Credential -Message "Enter a username and password for the VM administrator."
    ```

5. Создайте цикл, который выполняет три раза:

    ```powershell
    For ($i = 1; $i -le 3; $i++) 
    {

    }
    ```

6. В теле цикла создайте имя для каждой виртуальной машины и сохраните его в переменной:

    ```powershell
    $vmName = "ConferenceDemo" + $i
    ```

7. Создайте виртуальную машину с помощью переменной `$vmName`:

   ```powershell
   New-AzureRmVm -ResourceGroupName $resourceGroup -Name $vmName -Credential $adminCredential -Location "East US" 
   ```

8. Сохраните файл.

Готовый сценарий будет выглядеть так:

```powershell
param([string]$resourceGroup)

$adminCredential = Get-Credential -Message "Enter a username and password for the VM administrator."

Connect-AzureRmAccount

For ($i = 1; $i -le 3; $i++)
{
    $vmName = "ConferenceDemo" + $i

    New-AzureRmVm -ResourceGroupName $resourceGroup -Name $vmName -Credential $adminCredential -Location "East US" -Image UbuntuLTS
}
```

## <a name="execute-the-script"></a>Выполнение скрипта

Запустите PowerShell и перейдите в каталог, где был сохранен файл сценария. Чтобы запустить сценарий, выполните следующую команду:

```powershell
.\ConferenceDailyReset.ps1 TrialsResourceGroup
```

Выполнение сценария может занять несколько минут. После завершения убедитесь, что он выполнен успешно:

1. В браузере войдите на портал Azure.
2. В области навигации слева щелкните **Группы ресурсов**.
3. В списке групп ресурсов выберите **TrialsResourceGroup**. В списке ресурсов должны отображаться только что созданные виртуальные машины и связанные с ними ресурсы.

## <a name="summary"></a>Сводка
Вы написали сценарий, автоматизирующий создание трех виртуальных машин в группе ресурсов, указанной параметром сценария. Это короткий и простой сценарий, но он автоматизирует процесс, который может занять много времени при работе вручную на портале.