Администратор сети в компании по анализу данных отвечает за подключение к виртуальным машинам в Azure и проверку правильности их конфигурации. Для этого он подключается к пользовательскому интерфейсу рабочего стола Windows на виртуальной машине с помощью клиента протокола удаленного рабочего стола.

## <a name="what-is-the-remote-desktop-protocol"></a>Что такое протокол удаленного рабочего стола?

Протокол удаленного рабочего стола (RDP) обеспечивает удаленное подключение к пользовательскому интерфейсу компьютеров Windows. RDP позволяет входить в систему удаленного физического или виртуального компьютера Windows и контролировать этот компьютер так, как если бы вы использовали консоль.

> [!Note]
> Windows Hyper-V в Windows Server 2016 и Windows 10 используют RDP для подключения к виртуальным машинам, запущенным в гипервизоре.

RDP-подключение позволяет реализовывать большинство операций, которые можно выполнять с консоли физического компьютера, за исключением некоторых функций, связанных с электропитанием и оборудованием.

Для подключения по протоколу RDP требуется клиент RDP. Корпорация Майкрософт предоставляет клиенты RDP для следующих операционных систем:

* Windows
* iOS
* MacOS
* Android

Кроме того, подключаться к ПК Windows позволяют некоторые клиенты Linux с открытым исходным кодом из дистрибутива Ubuntu, например Remmina.

Клиент RDP входит в состав Windows 10.

![Клиент RDP Windows](../media-drafts/4-rdp-client.PNG)

## <a name="what-functionality-does-an-rdp-connection-support"></a>Какие функции поддерживает подключение по протоколу RDP?

С помощью подключения по протоколу RDP можно взаимодействовать с пользовательским интерфейсом. Кроме того, можно также подключаться к другим службам на удаленном компьютере. К этим службам относятся следующие:

* Подключения к принтерам — использование удаленного компьютера для печати на локальном устройстве печати.
* Воспроизведение звука — воспроизведение звука на локальном компьютере или на удаленном устройстве.
* Запись звука — запись звука с локального компьютера и направление этого звука на удаленное устройство.
* Порты — для перенаправления на порты на локальный компьютер.
* Диски (включая подключенные сетевые диски) — отображение дисков как подключенных к удаленному компьютеру.
* Устройства видеозаписи, такие как встроенные веб-камеры.
* Другие поддерживаемые самонастраивающиеся устройства.

В связи с ограничениями, связанными с доступностью определенных физических ресурсов в Azure, на этой платформе поддерживается лишь часть перечисленных функций. Например, через RDP-подключение от размещенной в Azure виртуальной машины к устройствам печати подключающихся клиентов могут перенаправляться только программные принтеры.

## <a name="configure-network-settings-for-rdp-access-to-virtual-machines"></a>Настройка параметров сети для доступа к виртуальным машинам по протоколу RDP

Существует три способа подключения к виртуальным машинам Azure.

1. Непосредственно к общедоступному IP-адресу виртуальной машины.
2. Через подключение к виртуальной частной сети (VPN).
3. Через подключение ExpressRoute.

Общедоступный IP-адрес может быть выделенным на постоянной основе или динамическим. Также требуется доступ к общедоступному адресу виртуальной машины через порт 3389 (RDP). Для этого может потребоваться обратиться к группе специалистов, управляющей безопасностью брандмауэра организации, чтобы они разработали правило для использования общедоступного IP-адреса виртуальной машины на порту 3389.

Динамические общедоступные IP-адреса перераспределяются при каждом перезапуске виртуальной машины. Статические адреса являются постоянными, но стоят дороже.

Для подключения через виртуальную частную сеть локальная сеть должна иметь активное VPN-подключение к Microsoft Azure.

Управление подключением к виртуальной машине осуществляется с помощью канала ExpressRoute. Этот подход также обеспечивает наименьшую задержку и высочайшую пропускную способность.

> [!Note]
> Независимо от того, какой вариант используется для подключения к Azure, виртуальная машина должна быть доступна по протоколу RDP на заданном по умолчанию порту 3389. Виртуальную машину можно настроить так, чтобы она была доступна только с вашего собственного IP-адреса клиента. Выполнять подключение к виртуальной машине через порт 3389 по общедоступному IP-адресу рекомендуется только в тестовых средах. Для рабочих сред следует использовать вариант 2 или 3.

## <a name="how-do-you-connect-to-a-vm-in-azure-using-rdp"></a>Как осуществляется подключение к виртуальной машине в Azure с помощью протокола RDP?

Подключиться к виртуальной машине в Azure с помощью протокола RDP очень просто. На портале Azure перейдите в раздел свойств виртуальной машины и в верхней части экрана щелкните **Подключить**. Будет скачан предварительно настроенный RDP-файл, который система Windows откроет в клиенте RDP. Вы можете подключиться через общедоступный IP-адрес виртуальной машины в RDP-файле. А при подключении через VPN или ExpressRoute можно выбрать внутренний IP-адрес. Можно также выбрать номер порта для подключения.

Если для виртуальной машины вы используете статический общедоступный IP-адрес, сохраните RDP-файл на рабочем столе. Если вы используете динамическую IP-адресацию, RDP-файл будет действительным, только пока виртуальная машина находится в рабочем режиме. В случае остановки и перезапуска виртуальной машины потребуется скачать другой RDP-файл.

> [!Note]
> Можно также ввести общедоступный IP-адрес виртуальной машины в клиенте RDP Windows и нажать кнопку **Подключить**.

Как правило, при подключении появляются два предупреждения. а именно:

* Предупреждение об издателе выводится, если у RDP-файла отсутствует общедоступная подпись.
* Предупреждение о сертификате выводится, если сертификат компьютера не является доверенным.

В тестовой среде эти предупреждения можно игнорировать. В рабочих средах RDP-файл может быть подписан с помощью служебной программы RDPSIGN.EXE и сертификата компьютера, находящегося в хранилище **доверенных корневых центров сертификации** клиента.

## <a name="summary"></a>Сводка

Теперь вы можете подключаться к виртуальной машине Windows по протоколу RDP. В следующем упражнении вы подключитесь к виртуальной машине по протоколу RDP и установите на этом компьютере роль сервера.
