<span data-ttu-id="348d8-101">Администратор сети в компании по анализу данных отвечает за подключение к виртуальным машинам в Azure и проверку правильности их конфигурации.</span><span class="sxs-lookup"><span data-stu-id="348d8-101">As a network administrator at a data analysis company, you're responsible for connecting to virtual machines in Azure and checking that they're properly configured.</span></span> <span data-ttu-id="348d8-102">Для этого он подключается к пользовательскому интерфейсу рабочего стола Windows на виртуальной машине с помощью клиента протокола удаленного рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="348d8-102">You do that using a Remote Desktop Protocol client to connect to the VM's Windows desktop UI.</span></span>

## <a name="what-is-the-remote-desktop-protocol"></a><span data-ttu-id="348d8-103">Что такое протокол удаленного рабочего стола?</span><span class="sxs-lookup"><span data-stu-id="348d8-103">What is the Remote Desktop Protocol?</span></span>

<span data-ttu-id="348d8-104">Протокол удаленного рабочего стола (RDP) обеспечивает удаленное подключение к пользовательскому интерфейсу компьютеров Windows.</span><span class="sxs-lookup"><span data-stu-id="348d8-104">Remote Desktop Protocol (RDP) provides remote connectivity to the UI of Windows-based computers.</span></span> <span data-ttu-id="348d8-105">RDP позволяет входить в систему удаленного физического или виртуального компьютера Windows и контролировать этот компьютер так, как если бы вы использовали консоль.</span><span class="sxs-lookup"><span data-stu-id="348d8-105">RDP enables you to sign in to a remote physical or virtual Windows computer and control that computer as if you were seated at the console.</span></span>

> [!Note]
> <span data-ttu-id="348d8-106">Windows Hyper-V в Windows Server 2016 и Windows 10 используют RDP для подключения к виртуальным машинам, запущенным в гипервизоре.</span><span class="sxs-lookup"><span data-stu-id="348d8-106">Windows Hyper-V in Windows Server 2016 and Windows 10 uses RDP to connect to virtual machines running on the hypervisor.</span></span>

<span data-ttu-id="348d8-107">RDP-подключение позволяет реализовывать большинство операций, которые можно выполнять с консоли физического компьютера, за исключением некоторых функций, связанных с электропитанием и оборудованием.</span><span class="sxs-lookup"><span data-stu-id="348d8-107">An RDP connection enables you to carry out the vast majority of operations that you can do from the console of a physical computer, with the exception of some power and hardware-related functions.</span></span>

<span data-ttu-id="348d8-108">Для подключения по протоколу RDP требуется клиент RDP.</span><span class="sxs-lookup"><span data-stu-id="348d8-108">An RDP connection requires an RDP client.</span></span> <span data-ttu-id="348d8-109">Корпорация Майкрософт предоставляет клиенты RDP для следующих операционных систем:</span><span class="sxs-lookup"><span data-stu-id="348d8-109">Microsoft provides RDP clients for the following operating systems:</span></span>

* <span data-ttu-id="348d8-110">Windows</span><span class="sxs-lookup"><span data-stu-id="348d8-110">Windows</span></span>
* <span data-ttu-id="348d8-111">iOS</span><span class="sxs-lookup"><span data-stu-id="348d8-111">iOS</span></span>
* <span data-ttu-id="348d8-112">MacOS</span><span class="sxs-lookup"><span data-stu-id="348d8-112">MacOS</span></span>
* <span data-ttu-id="348d8-113">Android</span><span class="sxs-lookup"><span data-stu-id="348d8-113">Android</span></span>

<span data-ttu-id="348d8-114">Кроме того, подключаться к ПК Windows позволяют некоторые клиенты Linux с открытым исходным кодом из дистрибутива Ubuntu, например Remmina.</span><span class="sxs-lookup"><span data-stu-id="348d8-114">There are also open-source Linux clients, such as Remmina that enable you to connect to a Windows PC from an Ubuntu distribution.</span></span>

<span data-ttu-id="348d8-115">Клиент RDP входит в состав Windows 10.</span><span class="sxs-lookup"><span data-stu-id="348d8-115">Windows 10 includes an RDP client.</span></span>

![Клиент RDP Windows](../images/2-rdp-client.PNG)

## <a name="what-functionality-does-an-rdp-connection-support"></a><span data-ttu-id="348d8-117">Какие функции поддерживает подключение по протоколу RDP?</span><span class="sxs-lookup"><span data-stu-id="348d8-117">What functionality does an RDP connection support?</span></span>

<span data-ttu-id="348d8-118">С помощью подключения по протоколу RDP можно взаимодействовать с пользовательским интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="348d8-118">With an RDP connection, you can interact with the UI.</span></span> <span data-ttu-id="348d8-119">Кроме того, можно также подключаться к другим службам на удаленном компьютере.</span><span class="sxs-lookup"><span data-stu-id="348d8-119">However, you can also connect to other services on the remote computer.</span></span> <span data-ttu-id="348d8-120">К этим службам относятся следующие:</span><span class="sxs-lookup"><span data-stu-id="348d8-120">These services include:</span></span>

* <span data-ttu-id="348d8-121">Подключения к принтерам — использование удаленного компьютера для печати на локальном устройстве печати.</span><span class="sxs-lookup"><span data-stu-id="348d8-121">Printer connections that enable the remote computer to print to your local print device.</span></span>
* <span data-ttu-id="348d8-122">Воспроизведение звука — воспроизведение звука на локальном компьютере или на удаленном устройстве.</span><span class="sxs-lookup"><span data-stu-id="348d8-122">Audio playback, where audio can play either on the local computer or on the remote device.</span></span>
* <span data-ttu-id="348d8-123">Запись звука — запись звука с локального компьютера и направление этого звука на удаленное устройство.</span><span class="sxs-lookup"><span data-stu-id="348d8-123">Audio recording, where you can record audio from the local computer and direct that sound to the remote device.</span></span>
* <span data-ttu-id="348d8-124">Порты — для перенаправления на порты на локальный компьютер.</span><span class="sxs-lookup"><span data-stu-id="348d8-124">Ports, which you can redirect to the ports on the local computer.</span></span>
* <span data-ttu-id="348d8-125">Диски (включая подключенные сетевые диски) — отображение дисков как подключенных к удаленному компьютеру.</span><span class="sxs-lookup"><span data-stu-id="348d8-125">Drives, including mapped network drives, where the drives will appear as connected to the remote computer.</span></span>
* <span data-ttu-id="348d8-126">Устройства видеозаписи, такие как встроенные веб-камеры.</span><span class="sxs-lookup"><span data-stu-id="348d8-126">Video capture devices, such as integrated web cams.</span></span>
* <span data-ttu-id="348d8-127">Другие поддерживаемые самонастраивающиеся устройства.</span><span class="sxs-lookup"><span data-stu-id="348d8-127">Other supported plug and play devices.</span></span>

<span data-ttu-id="348d8-128">В связи с ограничениями, связанными с доступностью определенных физических ресурсов в Azure, на этой платформе поддерживается лишь часть перечисленных функций.</span><span class="sxs-lookup"><span data-stu-id="348d8-128">Not all of these features are supported in Azure, as there are restrictions on what physical assets are available on that platform.</span></span> <span data-ttu-id="348d8-129">Например, через RDP-подключение от размещенной в Azure виртуальной машины к устройствам печати подключающихся клиентов могут перенаправляться только программные принтеры.</span><span class="sxs-lookup"><span data-stu-id="348d8-129">For example, only software printers can be redirected across an RDP connection from an Azure-hosted VM to the connecting client's print devices.</span></span>

## <a name="configure-network-settings-for-rdp-access-to-virtual-machines"></a><span data-ttu-id="348d8-130">Настройка параметров сети для доступа к виртуальным машинам по протоколу RDP</span><span class="sxs-lookup"><span data-stu-id="348d8-130">Configure network settings for RDP access to virtual machines</span></span>

<span data-ttu-id="348d8-131">Существует три способа подключения к виртуальным машинам Azure.</span><span class="sxs-lookup"><span data-stu-id="348d8-131">Connections to Azure VMs can be made in three ways:</span></span>

1. <span data-ttu-id="348d8-132">Непосредственно к общедоступному IP-адресу виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="348d8-132">Directly to the public IP address of the VM.</span></span>
2. <span data-ttu-id="348d8-133">Через подключение к виртуальной частной сети (VPN).</span><span class="sxs-lookup"><span data-stu-id="348d8-133">Through a virtual private network (VPN) connection.</span></span>
3. <span data-ttu-id="348d8-134">Через подключение ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="348d8-134">Through an ExpressRoute connection.</span></span>

<span data-ttu-id="348d8-135">Общедоступный IP-адрес может быть выделенным на постоянной основе или динамическим.</span><span class="sxs-lookup"><span data-stu-id="348d8-135">A public IP address can be either permanently allocated or dynamic.</span></span> <span data-ttu-id="348d8-136">Также требуется доступ к общедоступному адресу виртуальной машины через порт 3389 (RDP).</span><span class="sxs-lookup"><span data-stu-id="348d8-136">You also need to ensure that you have access to the VM's public address on port 3389 (RDP).</span></span> <span data-ttu-id="348d8-137">Для этого может потребоваться обратиться к группе специалистов, управляющей безопасностью брандмауэра организации, чтобы они разработали правило для использования общедоступного IP-адреса виртуальной машины на порту 3389.</span><span class="sxs-lookup"><span data-stu-id="348d8-137">This provision may require negotiation with the team that's managing your organization's firewall security, setting up a rule to your VM's public IP address on port 3389.</span></span>

<span data-ttu-id="348d8-138">Динамические общедоступные IP-адреса перераспределяются при каждом перезапуске виртуальной машины.</span><span class="sxs-lookup"><span data-stu-id="348d8-138">Dynamic public IP addresses are reallocated every time the VM restarts.</span></span> <span data-ttu-id="348d8-139">Статические адреса являются постоянными, но стоят дороже.</span><span class="sxs-lookup"><span data-stu-id="348d8-139">Static addresses are persistent, but cost more.</span></span>

<span data-ttu-id="348d8-140">Для подключения через виртуальную частную сеть локальная сеть должна иметь активное VPN-подключение к Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="348d8-140">To connect through a VPN, your local network must have an active VPN connection to Microsoft Azure.</span></span>

<span data-ttu-id="348d8-141">Управление подключением к виртуальной машине осуществляется с помощью канала ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="348d8-141">The ExpressRoute link approach manages connectivity to the VM.</span></span> <span data-ttu-id="348d8-142">Этот подход также обеспечивает наименьшую задержку и высочайшую пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="348d8-142">This approach also provides the lowest latency and highest bandwidth connection.</span></span>

> [!Note]
> <span data-ttu-id="348d8-143">Независимо от того, какой вариант используется для подключения к Azure, виртуальная машина должна быть доступна по протоколу RDP на заданном по умолчанию порту 3389.</span><span class="sxs-lookup"><span data-stu-id="348d8-143">Regardless of which option you use to connect to Azure, you need to ensure the virtual machine is accessible over RDP, typically on the default port 3389.</span></span> <span data-ttu-id="348d8-144">Виртуальную машину можно настроить так, чтобы она была доступна только с вашего собственного IP-адреса клиента.</span><span class="sxs-lookup"><span data-stu-id="348d8-144">You can configure the VM so it can be accessed only from your own client IP address.</span></span> <span data-ttu-id="348d8-145">Выполнять подключение к виртуальной машине через порт 3389 по общедоступному IP-адресу рекомендуется только в тестовых средах.</span><span class="sxs-lookup"><span data-stu-id="348d8-145">Connecting to a VM over port 3389 on a public IP address is only recommended for test environments.</span></span> <span data-ttu-id="348d8-146">Для рабочих сред следует использовать вариант 2 или 3.</span><span class="sxs-lookup"><span data-stu-id="348d8-146">In production environments, use option 2 or 3.</span></span>

## <a name="how-do-you-connect-to-a-vm-in-azure-using-rdp"></a><span data-ttu-id="348d8-147">Как осуществляется подключение к виртуальной машине в Azure с помощью протокола RDP?</span><span class="sxs-lookup"><span data-stu-id="348d8-147">How do you connect to a VM in Azure using RDP?</span></span>

<span data-ttu-id="348d8-148">Подключиться к виртуальной машине в Azure с помощью протокола RDP очень просто.</span><span class="sxs-lookup"><span data-stu-id="348d8-148">Connecting to a VM in Azure using RDP is a simple process.</span></span> <span data-ttu-id="348d8-149">На портале Azure перейдите в раздел свойств виртуальной машины и в верхней части экрана щелкните **Подключить**.</span><span class="sxs-lookup"><span data-stu-id="348d8-149">In the Azure portal, you go to the properties of your VM, and at the top, click **Connect**.</span></span> <span data-ttu-id="348d8-150">Будет скачан предварительно настроенный RDP-файл, который система Windows откроет в клиенте RDP.</span><span class="sxs-lookup"><span data-stu-id="348d8-150">This action downloads a preconfigured .RDP file that Windows then opens in the RDP client.</span></span> <span data-ttu-id="348d8-151">Вы можете подключиться через общедоступный IP-адрес виртуальной машины в RDP-файле.</span><span class="sxs-lookup"><span data-stu-id="348d8-151">You can choose to connect over the public IP address of the VM in the RDP file.</span></span> <span data-ttu-id="348d8-152">А при подключении через VPN или ExpressRoute можно выбрать внутренний IP-адрес.</span><span class="sxs-lookup"><span data-stu-id="348d8-152">Alternatively, if you're connecting over VPN or ExpressRoute, you can select the internal IP address.</span></span> <span data-ttu-id="348d8-153">Можно также выбрать номер порта для подключения.</span><span class="sxs-lookup"><span data-stu-id="348d8-153">You can also select the port number for the connection.</span></span>

<span data-ttu-id="348d8-154">Если для виртуальной машины вы используете статический общедоступный IP-адрес, сохраните RDP-файл на рабочем столе.</span><span class="sxs-lookup"><span data-stu-id="348d8-154">If you're using a static public IP address for the VM, you can save the .RDP file to your desktop.</span></span> <span data-ttu-id="348d8-155">Если вы используете динамическую IP-адресацию, RDP-файл будет действительным, только пока виртуальная машина находится в рабочем режиме.</span><span class="sxs-lookup"><span data-stu-id="348d8-155">If you're using dynamic IP addressing, the .RDP file only remains valid while the VM is running.</span></span> <span data-ttu-id="348d8-156">В случае остановки и перезапуска виртуальной машины потребуется скачать другой RDP-файл.</span><span class="sxs-lookup"><span data-stu-id="348d8-156">If you stop and restart the VM, you must download another .RDP file.</span></span>

> [!Note]
> <span data-ttu-id="348d8-157">Можно также ввести общедоступный IP-адрес виртуальной машины в клиенте RDP Windows и нажать кнопку **Подключить**.</span><span class="sxs-lookup"><span data-stu-id="348d8-157">You can also enter the public IP address of the VM into the Windows RDP client and click **Connect**.</span></span>

<span data-ttu-id="348d8-158">Как правило, при подключении появляются два предупреждения.</span><span class="sxs-lookup"><span data-stu-id="348d8-158">When you connect, you will typically receive two warnings.</span></span> <span data-ttu-id="348d8-159">а именно:</span><span class="sxs-lookup"><span data-stu-id="348d8-159">These are:</span></span>

* <span data-ttu-id="348d8-160">Предупреждение об издателе выводится, если у RDP-файла отсутствует общедоступная подпись.</span><span class="sxs-lookup"><span data-stu-id="348d8-160">Publisher warning - caused by the .RDP file not being publicly signed.</span></span>
* <span data-ttu-id="348d8-161">Предупреждение о сертификате выводится, если сертификат компьютера не является доверенным.</span><span class="sxs-lookup"><span data-stu-id="348d8-161">Certificate warning - caused by the machine certificate not being trusted.</span></span>

<span data-ttu-id="348d8-162">В тестовой среде эти предупреждения можно игнорировать.</span><span class="sxs-lookup"><span data-stu-id="348d8-162">In test environments, these warnings can be ignored.</span></span> <span data-ttu-id="348d8-163">В рабочих средах RDP-файл может быть подписан с помощью служебной программы RDPSIGN.EXE и сертификата компьютера, находящегося в хранилище **доверенных корневых центров сертификации** клиента.</span><span class="sxs-lookup"><span data-stu-id="348d8-163">In production environments, the .RDP file could be signed using RDPSIGN.EXE and the machine certificate placed in the client's **Trusted Root Certification Authorities** store.</span></span>

## <a name="summary"></a><span data-ttu-id="348d8-164">Сводка</span><span class="sxs-lookup"><span data-stu-id="348d8-164">Summary</span></span>

<span data-ttu-id="348d8-165">Теперь вы можете подключаться к виртуальной машине Windows по протоколу RDP.</span><span class="sxs-lookup"><span data-stu-id="348d8-165">Now you can connect to a Windows VM by using RDP.</span></span> <span data-ttu-id="348d8-166">В следующем упражнении вы подключитесь к виртуальной машине по протоколу RDP и установите на этом компьютере роль сервера.</span><span class="sxs-lookup"><span data-stu-id="348d8-166">In the following exercise, you will use RDP to connect to a VM, then install a server role on that computer.</span></span>
