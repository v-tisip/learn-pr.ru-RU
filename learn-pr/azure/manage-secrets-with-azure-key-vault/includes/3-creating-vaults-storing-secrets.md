## <a name="creating-key-vaults-for-your-applications"></a><span data-ttu-id="f1409-101">Создание хранилищ ключей для приложений</span><span class="sxs-lookup"><span data-stu-id="f1409-101">Creating Key Vaults for your applications</span></span>

<span data-ttu-id="f1409-102">Рекомендуется предоставлять каждому приложению отдельное хранилище для каждой среды развертывания, например среды разработки, тестовой и рабочей среды.</span><span class="sxs-lookup"><span data-stu-id="f1409-102">Good practice is to give each application a separate vault for each deployment environment you use, such as development, test, and production.</span></span> <span data-ttu-id="f1409-103">Использовать одни и те же секреты для нескольких приложений может быть удобно, однако последствия получения злоумышленником доступа к хранилищу усугубляются с увеличением количества секретов в нем.</span><span class="sxs-lookup"><span data-stu-id="f1409-103">It may be convenient to share secrets across apps, but the impact of an attacker gaining read access to a vault increases with the number of secrets in the vault.</span></span>

> [!TIP]
> <span data-ttu-id="f1409-104">Если вы используете одни и те же имена секретов в разных средах, единственный параметр конфигурации, который будет различаться для отдельных сред, — это URL-адрес хранилища.</span><span class="sxs-lookup"><span data-stu-id="f1409-104">If you use the same names for secrets across different environments, the only environment-specific configuration that has to change in your app is the vault URL.</span></span>

<span data-ttu-id="f1409-105">Для создания хранилища начальная конфигурация не требуется.</span><span class="sxs-lookup"><span data-stu-id="f1409-105">Creating a vault requires no initial configuration.</span></span> <span data-ttu-id="f1409-106">Вашему удостоверению пользователя автоматически предоставляется полный набор разрешений на управление секретами, и вы можете немедленно начинать добавлять секреты.</span><span class="sxs-lookup"><span data-stu-id="f1409-106">Your user identity is automatically granted the full set of secret management permissions and you can start adding secrets immediately.</span></span> <span data-ttu-id="f1409-107">Когда хранилище создано, добавление секретов и управление ими можно осуществлять в интерфейсе администрирования Azure, включая портал Azure, Azure CLI и Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f1409-107">Once you have a vault, adding and managing secrets can be done from any Azure administrative interface, including the Azure portal, the Azure CLI, and Azure PowerShell.</span></span> <span data-ttu-id="f1409-108">Настроив использование хранилища приложением, необходимо назначить ему соответствующие разрешения, которые будут рассмотрены в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="f1409-108">When you set up your application to use the vault, you'll need to assign the correct permissions to it; we'll see that in the next unit.</span></span>

## <a name="vault-authentication-and-permissions"></a><span data-ttu-id="f1409-109">Проверка подлинности и разрешения хранилища</span><span class="sxs-lookup"><span data-stu-id="f1409-109">Vault authentication and permissions</span></span>

<span data-ttu-id="f1409-110">Интерфейс API Azure Key Vault использует Azure Active Directory для проверки подлинности пользователей и приложений.</span><span class="sxs-lookup"><span data-stu-id="f1409-110">Azure Key Vault's API uses Azure Active Directory to authenticate users and applications.</span></span> <span data-ttu-id="f1409-111">Политики доступа к хранилищу основаны на *действиях* и применяются ко всему хранилищу.</span><span class="sxs-lookup"><span data-stu-id="f1409-111">Vault access policies are based on *actions*, and are applied across an entire vault.</span></span> <span data-ttu-id="f1409-112">Например, приложение с разрешениями на **получение** (чтение значений секретов), **вывод списка** (получение списка имен всех секретов) и **задание** (создание или изменение значений секретов) может создавать секреты, получать список имен всех секретов, а также получать и задавать значения всех секретов в хранилище.</span><span class="sxs-lookup"><span data-stu-id="f1409-112">For example, an application with **Get** (read secret values), **List** (list names of all secrets), and **Set** (create or update secret values) permissions to a vault is able to create secrets, list all secret names, and get and set all secret values in that vault.</span></span>

<span data-ttu-id="f1409-113">*Все* действия, выполняемые с хранилищем, требуют проверки подлинности и авторизации &mdash; анонимный доступ невозможен.</span><span class="sxs-lookup"><span data-stu-id="f1409-113">*All* actions performed on a vault require authentication and authorization &mdash; there is no way to grant any kind of anonymous access.</span></span>

> [!TIP]
> <span data-ttu-id="f1409-114">При предоставлении доступа к хранилищу разработчикам и приложениям назначайте минимальный набор разрешений.</span><span class="sxs-lookup"><span data-stu-id="f1409-114">When granting vault access to developers and apps, grant only the minimum set of permissions needed.</span></span> <span data-ttu-id="f1409-115">Ограничение разрешений позволяет избежать инцидентов из-за ошибок в коде и сократить последствия кражи учетных данных или внедрения вредоносного кода в приложение.</span><span class="sxs-lookup"><span data-stu-id="f1409-115">Permissions restrictions help avoid accidents caused by code bugs and reduce the impact of stolen credentials or malicious code injected into your app.</span></span>

<span data-ttu-id="f1409-116">Разработчикам, как правило, требуются только разрешения на **получение** и **вывод списка** для хранилища среды разработки.</span><span class="sxs-lookup"><span data-stu-id="f1409-116">Developers will usually only need **Get** and **List** permissions to a development-environment vault.</span></span> <span data-ttu-id="f1409-117">Руководителю или старшему разработчику требуются полные разрешения на доступ к хранилищу для изменения и добавления секретов по мере необходимости.</span><span class="sxs-lookup"><span data-stu-id="f1409-117">A lead or senior developer will need full permissions to the vault to change and add secrets when necessary.</span></span> <span data-ttu-id="f1409-118">Полные разрешения на доступ к хранилищам рабочей среды обычно резервируются для старшего эксплуатационного персонала.</span><span class="sxs-lookup"><span data-stu-id="f1409-118">Full permissions to production-environment vaults are typically reserved for senior operations staff.</span></span>

<span data-ttu-id="f1409-119">Приложениям, как правило, требуются только разрешения на **получение**.</span><span class="sxs-lookup"><span data-stu-id="f1409-119">For apps, typically only **Get** permissions are required.</span></span> <span data-ttu-id="f1409-120">Некоторым приложениям может требоваться разрешение на **вывод списка** в зависимости от их реализации.</span><span class="sxs-lookup"><span data-stu-id="f1409-120">Some apps may require **List** depending on the way the app is implemented.</span></span> <span data-ttu-id="f1409-121">Приложение, которое мы реализуем в упражнении в этом модуле, требует разрешения на **вывод списка** из-за способа чтения секретов из хранилища.</span><span class="sxs-lookup"><span data-stu-id="f1409-121">The app we'll implement in this module's exercise requires the **List** permission because of the technique it uses to read secrets from the vault.</span></span>

## <a name="exercise"></a><span data-ttu-id="f1409-122">Упражнение</span><span class="sxs-lookup"><span data-stu-id="f1409-122">Exercise</span></span>

<span data-ttu-id="f1409-123">Ваша компания испытывает трудности с управлением секретами приложений и попросила вас создать небольшое простое приложение для обучения других разработчиков.</span><span class="sxs-lookup"><span data-stu-id="f1409-123">Given all the trouble the company's been having with application secrets, management has asked you to create a small starter app to set the other developers on the right path.</span></span> <span data-ttu-id="f1409-124">Оно должно демонстрировать максимально простые и безопасные методы управления секретами.</span><span class="sxs-lookup"><span data-stu-id="f1409-124">The app needs to demonstrate best practices for managing secrets as simply and securely as possible.</span></span>

<span data-ttu-id="f1409-125">Сначала вы создаете хранилище и сохраняете в нем один секрет.</span><span class="sxs-lookup"><span data-stu-id="f1409-125">To start, you'll create a vault and store one secret.</span></span>

### <a name="create-a-resource-group"></a><span data-ttu-id="f1409-126">Создание группы ресурсов</span><span class="sxs-lookup"><span data-stu-id="f1409-126">Create a resource group</span></span>

<span data-ttu-id="f1409-127">Создайте группу ресурсов `keyvault-exercise-group`, в которой будут находиться все ресурсы в этом упражнении.</span><span class="sxs-lookup"><span data-stu-id="f1409-127">Create a resource group called `keyvault-exercise-group` for all of the resources in this exercise.</span></span> <span data-ttu-id="f1409-128">В конце модуля мы удалим эту группу, чтобы очистить сразу все ресурсы.</span><span class="sxs-lookup"><span data-stu-id="f1409-128">At the end of this module, we'll be deleting this resource group to clean up everything at once.</span></span> <span data-ttu-id="f1409-129">Группа `eastus` будет содержать все ресурсы, необходимые в этом упражнении.</span><span class="sxs-lookup"><span data-stu-id="f1409-129">We'll use `eastus` as the location for everything in this exercise.</span></span>

<span data-ttu-id="f1409-130">В терминале Azure Cloud Shell справа выполните приведенную ниже команду Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="f1409-130">Use the Azure Cloud Shell terminal on the right to run the following Azure CLI command.</span></span> <span data-ttu-id="f1409-131">Она создаст группу ресурсов в подписке.</span><span class="sxs-lookup"><span data-stu-id="f1409-131">This will create the resource group in your subscription.</span></span>

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a><span data-ttu-id="f1409-132">Создание хранилища и сохранение секрета</span><span class="sxs-lookup"><span data-stu-id="f1409-132">Create the vault and store the secret in it</span></span>

<span data-ttu-id="f1409-133">Далее мы создадим хранилище и сохраним в нем секрет.</span><span class="sxs-lookup"><span data-stu-id="f1409-133">Next, we'll create the vault and store our secret in it.</span></span>

<span data-ttu-id="f1409-134">**Имена хранилищ ключей должны быть уникальными на глобальном уровне, поэтому вам нужно выбрать уникальное имя.**</span><span class="sxs-lookup"><span data-stu-id="f1409-134">**Key Vault names must be globally unique, so you'll need to pick a unique name**.</span></span> <span data-ttu-id="f1409-135">Имена хранилищ должны быть длиной от 3 до 24 символов и могут содержать только буквы, цифры и дефисы.</span><span class="sxs-lookup"><span data-stu-id="f1409-135">Vault names must be 3-24 characters long and contain only alphanumeric characters and dashes.</span></span>

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

<span data-ttu-id="f1409-136">По завершении вы увидите выходные данные в формате JSON с описанием нового хранилища.</span><span class="sxs-lookup"><span data-stu-id="f1409-136">When it finishes, you'll see JSON output describing the new vault.</span></span>

<span data-ttu-id="f1409-137">Теперь добавьте секрет: он будет иметь имя **SecretPassword** и значение **reindeer_flotilla**.</span><span class="sxs-lookup"><span data-stu-id="f1409-137">Now add the secret: our secret will be named **SecretPassword** with a value of **reindeer_flotilla**.</span></span>

```azurecli
az keyvault secret set --name SecretPassword --value open_sesame --vault-name <your-unique-vault-name>
```

<span data-ttu-id="f1409-138">Запишите имя хранилища &mdash;. Оно скоро понадобится опять.</span><span class="sxs-lookup"><span data-stu-id="f1409-138">Make a note of the vault name &mdash; you'll be needing it again soon.</span></span>

<span data-ttu-id="f1409-139">Через некоторое время мы напишем код приложения, но сначала нам нужно немного узнать о том, как приложение будет проходить проверку подлинности в хранилище.</span><span class="sxs-lookup"><span data-stu-id="f1409-139">We'll write the code for our application shortly, but first we need to learn a little bit about how our app is going to authenticate to a vault.</span></span>