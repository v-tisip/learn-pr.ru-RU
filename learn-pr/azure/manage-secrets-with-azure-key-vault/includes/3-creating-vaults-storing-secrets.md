## <a name="creating-key-vaults-for-your-applications"></a>Создание хранилищ ключей для приложений

Рекомендуется предоставлять каждому приложению отдельное хранилище для каждой среды развертывания, например среды разработки, тестовой и рабочей среды. Использовать одни и те же секреты для нескольких приложений может быть удобно, однако последствия получения злоумышленником доступа к хранилищу усугубляются с увеличением количества секретов в нем.

> [!TIP]
> Если вы используете одни и те же имена секретов в разных средах, единственный параметр конфигурации, который будет различаться для отдельных сред, — это URL-адрес хранилища.

Для создания хранилища начальная конфигурация не требуется. Вашему удостоверению пользователя автоматически предоставляется полный набор разрешений на управление секретами, и вы можете немедленно начинать добавлять секреты. Когда хранилище создано, добавление секретов и управление ими можно осуществлять в интерфейсе администрирования Azure, включая портал Azure, Azure CLI и Azure PowerShell. Настроив использование хранилища приложением, необходимо назначить ему соответствующие разрешения, которые будут рассмотрены в следующем разделе.

## <a name="vault-authentication-and-permissions"></a>Проверка подлинности и разрешения хранилища

Интерфейс API Azure Key Vault использует Azure Active Directory для проверки подлинности пользователей и приложений. Политики доступа к хранилищу основаны на *действиях* и применяются ко всему хранилищу. Например, приложение с разрешениями на **получение** (чтение значений секретов), **вывод списка** (получение списка имен всех секретов) и **задание** (создание или изменение значений секретов) может создавать секреты, получать список имен всех секретов, а также получать и задавать значения всех секретов в хранилище.

*Все* действия, выполняемые с хранилищем, требуют проверки подлинности и авторизации &mdash; анонимный доступ невозможен.

> [!TIP]
> При предоставлении доступа к хранилищу разработчикам и приложениям назначайте минимальный набор разрешений. Ограничение разрешений позволяет избежать инцидентов из-за ошибок в коде и сократить последствия кражи учетных данных или внедрения вредоносного кода в приложение.

Разработчикам, как правило, требуются только разрешения на **получение** и **вывод списка** для хранилища среды разработки. Руководителю или старшему разработчику требуются полные разрешения на доступ к хранилищу для изменения и добавления секретов по мере необходимости. Полные разрешения на доступ к хранилищам рабочей среды обычно резервируются для старшего эксплуатационного персонала.

Приложениям, как правило, требуются только разрешения на **получение**. Некоторым приложениям может требоваться разрешение на **вывод списка** в зависимости от их реализации. Приложение, которое мы реализуем в упражнении в этом модуле, требует разрешения на **вывод списка** из-за способа чтения секретов из хранилища.

## <a name="exercise"></a>Упражнение

Ваша компания испытывает трудности с управлением секретами приложений и попросила вас создать небольшое простое приложение для обучения других разработчиков. Оно должно демонстрировать максимально простые и безопасные методы управления секретами.

Сначала вы создаете хранилище и сохраняете в нем один секрет.

### <a name="create-a-resource-group"></a>Создание группы ресурсов

Создайте группу ресурсов `keyvault-exercise-group`, в которой будут находиться все ресурсы в этом упражнении. В конце модуля мы удалим эту группу, чтобы очистить сразу все ресурсы. Группа `eastus` будет содержать все ресурсы, необходимые в этом упражнении.

В терминале Azure Cloud Shell справа выполните приведенную ниже команду Azure CLI. Она создаст группу ресурсов в подписке.

```azurecli
az group create --name keyvault-exercise-group --location eastus
```

### <a name="create-the-vault-and-store-the-secret-in-it"></a>Создание хранилища и сохранение секрета

Далее мы создадим хранилище и сохраним в нем секрет.

**Имена хранилищ ключей должны быть уникальными на глобальном уровне, поэтому вам нужно выбрать уникальное имя.** Имена хранилищ должны быть длиной от 3 до 24 символов и могут содержать только буквы, цифры и дефисы.

```azurecli
az keyvault create --name <your-unique-vault-name> --resource-group keyvault-exercise-group --location eastus
```

По завершении вы увидите выходные данные в формате JSON с описанием нового хранилища.

Теперь добавьте секрет: он будет иметь имя **SecretPassword** и значение **reindeer_flotilla**.

```azurecli
az keyvault secret set --name SecretPassword --value open_sesame --vault-name <your-unique-vault-name>
```

Запишите имя хранилища &mdash;. Оно скоро понадобится опять.

Через некоторое время мы напишем код приложения, но сначала нам нужно немного узнать о том, как приложение будет проходить проверку подлинности в хранилище.