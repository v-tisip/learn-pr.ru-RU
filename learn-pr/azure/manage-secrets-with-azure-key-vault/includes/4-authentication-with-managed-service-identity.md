Хранилище ключей Azure использует **Azure Active Directory** для проверки подлинности пользователей и приложений, которые пытаются получить доступ к хранилищу. Чтобы предоставить нашему веб-приложению доступ к хранилищу, зарегистрируем наше приложение в Azure Active Directory. При регистрации для приложения создается удостоверение. Имея удостоверение, можно назначить для него удостоверения хранилища.

Приложения и пользователи проходят проверку подлинности в хранилище ключей, используя токен проверки подлинности Azure Active Directory. Для получения токена из Azure Active Directory требуется секрет или сертификат, поскольку любой пользователь, у которого есть токен, может воспользоваться удостоверением приложения, чтобы получить доступ ко всем секретам в хранилище.

В хранилище секреты нашего приложения защищены, и все же для получения доступа к этим секретам необходимо хранить секрет или сертификат за пределами хранилища. Это называется *проблемой раскрутки компилятора*, и у Azure есть для нее решение.

## <a name="managed-service-identity"></a>Удостоверение управляемой службы

*Управляемое удостоверение службы* (MSI) — это функция службы приложений Azure, которую ваше приложение может использовать для доступа к хранилищу ключей и другим службам Azure, не управляя никакими секретами. MSI гораздо проще и безопаснее, чем самостоятельное управление секретом.

При включении MSI Azure активирует отдельную службу предоставления токенов REST специально для вашего приложения. Когда ваше приложение запрашивает токен у службы маркеров MSI, служба обращается к Azure Active Directory, чтобы получить токен для удостоверения MSI, и возвращает его в приложение для использования в хранилище ключей. Самое важное в этом процессе то, что ваше приложение проходит проверку подлинности в службе токенов MSI &mdash; вместо того, чтобы требовать для управления конфигурацией секрет или сертификат, и ваше приложение использует секрет, который Azure безопасно внедряет в его переменные среды при его запуске. Управлять значением этого секрета или хранить его где бы то ни было не нужно. Ничто, кроме вашего приложения, не сможет получить доступ к этому секрету или конечной точке службы маркеров MSI.

MSI также регистрирует приложение в Azure Active Directory и удалит регистрацию, если вы отключите MSI или удалите приложение.

MSI можно получить в любом выпуске Azure Active Directory, включая бесплатный выпуск, который входит в подписку Azure. В службе приложений его можно использовать бесплатно и без дополнительной настройки конфигурации. Кроме того, его можно включать и отключать в приложении в любое время.

> [!NOTE]
> MSI пока не поддерживается для Linux или веб-приложений контейнеров.

Для включения MSI нужно выполнить только одну команду интерфейса командной строки Azure без дополнительной настройки. Это мы сделаем в модуле 5, когда будем настраивать приложение службы приложений и разворачивать его в Azure. А пока применим наши знания об MSI, чтобы написать код для нашего приложения.