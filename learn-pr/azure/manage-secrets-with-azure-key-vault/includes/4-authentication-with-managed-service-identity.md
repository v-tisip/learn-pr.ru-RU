<span data-ttu-id="d5ae9-101">Хранилище ключей Azure использует **Azure Active Directory** для проверки подлинности пользователей и приложений, которые пытаются получить доступ к хранилищу.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-101">Azure Key Vault uses **Azure Active Directory** to authenticate users and applications that try to access a vault.</span></span> <span data-ttu-id="d5ae9-102">Чтобы предоставить нашему веб-приложению доступ к хранилищу, зарегистрируем наше приложение в Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-102">To grant our web application access to the vault, we first need to register our app with Azure Active Directory.</span></span> <span data-ttu-id="d5ae9-103">При регистрации для приложения создается удостоверение.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-103">Registering creates an identity for the app.</span></span> <span data-ttu-id="d5ae9-104">Имея удостоверение, можно назначить для него удостоверения хранилища.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-104">Once we have an identity, we can assign vault permissions to it.</span></span>

<span data-ttu-id="d5ae9-105">Приложения и пользователи проходят проверку подлинности в хранилище ключей, используя токен проверки подлинности Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-105">Apps and users authenticate to Key Vault using an Azure Active Directory authentication token.</span></span> <span data-ttu-id="d5ae9-106">Для получения токена из Azure Active Directory требуется секрет или сертификат, поскольку любой пользователь, у которого есть токен, может воспользоваться удостоверением приложения, чтобы получить доступ ко всем секретам в хранилище.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-106">Getting a token from Azure Active Directory requires a secret or certificate, because anyone with a token could use the application identity to access all of the secrets in the vault.</span></span>

<span data-ttu-id="d5ae9-107">В хранилище секреты нашего приложения защищены, и все же для получения доступа к этим секретам необходимо хранить секрет или сертификат за пределами хранилища.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-107">Our application secrets are secure in the vault, but we still need to keep a secret or certificate outside of the vault in order to access them!</span></span> <span data-ttu-id="d5ae9-108">Это называется *проблемой раскрутки компилятора*, и у Azure есть для нее решение.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-108">This problem is called the *bootstrapping problem*, and Azure has a solution for it.</span></span>

## <a name="managed-service-identity"></a><span data-ttu-id="d5ae9-109">Удостоверение управляемой службы</span><span class="sxs-lookup"><span data-stu-id="d5ae9-109">Managed Service Identity</span></span>

<span data-ttu-id="d5ae9-110">*Управляемое удостоверение службы* (MSI) — это функция службы приложений Azure, которую ваше приложение может использовать для доступа к хранилищу ключей и другим службам Azure, не управляя никакими секретами.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-110">*Managed Service Identity* (MSI) is a feature of Azure App Service that your app can use to access Key Vault and other Azure services without having to manage even a single secret.</span></span> <span data-ttu-id="d5ae9-111">MSI гораздо проще и безопаснее, чем самостоятельное управление секретом.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-111">Using MSI is simpler and more secure than managing a secret yourself.</span></span>

<span data-ttu-id="d5ae9-112">При включении MSI Azure активирует отдельную службу предоставления токенов REST специально для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-112">When you enable MSI, Azure activates a separate token-granting REST service specifically for use by your app.</span></span> <span data-ttu-id="d5ae9-113">Когда ваше приложение запрашивает токен у службы маркеров MSI, служба обращается к Azure Active Directory, чтобы получить токен для удостоверения MSI, и возвращает его в приложение для использования в хранилище ключей.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-113">When your app requests a token from the MSI token service, the service contacts Azure Active Directory to get a token for the MSI identity and hands it back to your app for use with Key Vault.</span></span> <span data-ttu-id="d5ae9-114">Самое важное в этом процессе то, что ваше приложение проходит проверку подлинности в службе токенов MSI &mdash; вместо того, чтобы требовать для управления конфигурацией секрет или сертификат, и ваше приложение использует секрет, который Azure безопасно внедряет в его переменные среды при его запуске.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-114">The most important part of this workflow is the way that your app authenticates to the MSI token service &mdash; instead of requiring a secret or certificate you need to manage in your configuration, your app uses a secret that Azure securely injects into its environment variables when it starts up.</span></span> <span data-ttu-id="d5ae9-115">Управлять значением этого секрета или хранить его где бы то ни было не нужно.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-115">You don't need to manage or store this secret value anywhere.</span></span> <span data-ttu-id="d5ae9-116">Ничто, кроме вашего приложения, не сможет получить доступ к этому секрету или конечной точке службы маркеров MSI.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-116">Nothing outside of your app can access this secret or the MSI token service endpoint.</span></span>

<span data-ttu-id="d5ae9-117">MSI также регистрирует приложение в Azure Active Directory и удалит регистрацию, если вы отключите MSI или удалите приложение.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-117">MSI also registers your app in Azure Active Directory for you, and will delete the registration if you disable MSI or delete the app.</span></span>

<span data-ttu-id="d5ae9-118">MSI можно получить в любом выпуске Azure Active Directory, включая бесплатный выпуск, который входит в подписку Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-118">MSI is available in all editions of Azure Active Directory, including the Free edition included with an Azure subscription.</span></span> <span data-ttu-id="d5ae9-119">В службе приложений его можно использовать бесплатно и без дополнительной настройки конфигурации. Кроме того, его можно включать и отключать в приложении в любое время.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-119">Using it in App Service has no extra cost and requires no configuration, and it can be enabled or disabled on an app at any time.</span></span>

> [!NOTE]
> <span data-ttu-id="d5ae9-120">MSI пока не поддерживается для Linux или веб-приложений контейнеров.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-120">MSI is not currently supported for Linux or Container web apps.</span></span>

<span data-ttu-id="d5ae9-121">Для включения MSI нужно выполнить только одну команду интерфейса командной строки Azure без дополнительной настройки.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-121">Enabling MSI requires only a single Azure CLI command with no configuration.</span></span> <span data-ttu-id="d5ae9-122">Это мы сделаем в модуле 5, когда будем настраивать приложение службы приложений и разворачивать его в Azure.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-122">We'll do it in unit 5 when we set up an App Service app and deploy to Azure.</span></span> <span data-ttu-id="d5ae9-123">А пока применим наши знания об MSI, чтобы написать код для нашего приложения.</span><span class="sxs-lookup"><span data-stu-id="d5ae9-123">Before that, though, we're going to apply our knowledge of MSI to write the code for our app.</span></span>