<span data-ttu-id="abed4-101">Далее мы рассмотрим пропускную способность данных для нашей базы данных.</span><span class="sxs-lookup"><span data-stu-id="abed4-101">Next we'll consider the data throughout for our database.</span></span> <span data-ttu-id="abed4-102">Необходимо следить за тем, чтобы объем транзакций, необходимый для нашей компании, был нам по плечу.</span><span class="sxs-lookup"><span data-stu-id="abed4-102">This is important to ensure we can handle the volume of transactions for our business needs.</span></span> <span data-ttu-id="abed4-103">Требования к пропускной способности могут варьироваться.</span><span class="sxs-lookup"><span data-stu-id="abed4-103">Throughput requirements aren't always consistent.</span></span> <span data-ttu-id="abed4-104">Например, в сезон распродаж и праздников пропускная способность веб-сайта электронного магазина должна увеличиваться.</span><span class="sxs-lookup"><span data-stu-id="abed4-104">For example, you may be building a shopping website that needs to scale during sales or holidays.</span></span> <span data-ttu-id="abed4-105">Для начала оценим требования к пропускной способности вашей базы данных.</span><span class="sxs-lookup"><span data-stu-id="abed4-105">We'll start estimating your database throughput requirements.</span></span>

## <a name="what-is-database-throughput"></a><span data-ttu-id="abed4-106">Что такое пропускная способность базы данных?</span><span class="sxs-lookup"><span data-stu-id="abed4-106">What is database throughput?</span></span> 

<span data-ttu-id="abed4-107">Пропускная способность базы данных — это количество операций чтения и записи, которые база данных может выполнить за одну секунду.</span><span class="sxs-lookup"><span data-stu-id="abed4-107">Database throughput is the number of reads and writes that your database can perform in a single second.</span></span> 

<span data-ttu-id="abed4-108">Для стратегического масштабирования пропускной способности оцените свои потребности в пропускной способности, определив, какой объем операций чтения и записи вам нужно будет поддерживать в различное время и с различными размерами документов.</span><span class="sxs-lookup"><span data-stu-id="abed4-108">To scale throughput strategically, you need to estimate your throughput needs by estimating the number of reads and writes you'll have to support at different times and for different document sizes.</span></span> <span data-ttu-id="abed4-109">Если оценка будет верной, ваши пользователи останутся довольны даже во время пиковых нагрузок.</span><span class="sxs-lookup"><span data-stu-id="abed4-109">If you estimate correctly, you'll keep your users happy when demand spikes.</span></span> <span data-ttu-id="abed4-110">Неверная оценка может привести к ограничению запросов по времени, к задержке и повторению операций, вызвав, таким образом, высокую задержку и недовольство клиентов.</span><span class="sxs-lookup"><span data-stu-id="abed4-110">If you estimate incorrectly, your requests can get rate-limited and operations will have to wait and retry, likely causing high latency and unhappy customers.</span></span>

## <a name="what-is-a-request-unit"></a><span data-ttu-id="abed4-111">Что такое единица запроса?</span><span class="sxs-lookup"><span data-stu-id="abed4-111">What is a request unit?</span></span>

<span data-ttu-id="abed4-112">Azure Cosmos DB измеряет пропускную способность, используя так называемую **единицу запроса (ЕЗ)**.</span><span class="sxs-lookup"><span data-stu-id="abed4-112">Azure Cosmos DB measures throughput using something called a **request unit (RU)**.</span></span> <span data-ttu-id="abed4-113">Измеряется число единиц запросов в секунду, поэтому единицей измерения служит число **единиц запроса в секунду (ЕЗ/с)**.</span><span class="sxs-lookup"><span data-stu-id="abed4-113">Request unit usage is measured per second, so the unit of measure is **request units per second (RU/s)**.</span></span> <span data-ttu-id="abed4-114">Количество ЕЗ/с, к которому должно быть готово решение Azure Cosmos DB, необходимо зарезервировать заранее, чтобы оно могло справиться с рассчитанной вами нагрузкой; значение ЕЗ/с можно увеличить или уменьшить в любое время в зависимости от текущих нужд.</span><span class="sxs-lookup"><span data-stu-id="abed4-114">You must reserve the number of RU/s you want Azure Cosmos DB to provision in advance, so it can handle the load you've estimated, and you can scale your RU/s up or down at any time to meet current demand.</span></span>

## <a name="request-unit-basics"></a><span data-ttu-id="abed4-115">Основные сведения о единицах запросов</span><span class="sxs-lookup"><span data-stu-id="abed4-115">Request unit basics</span></span>

<span data-ttu-id="abed4-116">Одна единица запроса (1 ЕЗ) равна примерной стоимости выполнения одного запроса GET для документа размером 1 КБ по идентификатору документа.</span><span class="sxs-lookup"><span data-stu-id="abed4-116">A single request unit, 1 RU, is equal to the approximate cost of performing a single GET request on a 1-KB document using a document's ID.</span></span> <span data-ttu-id="abed4-117">Выполнение запроса GET по идентификатору документа — эффективный способ извлечения документа, а значит, его стоимость будет невелика.</span><span class="sxs-lookup"><span data-stu-id="abed4-117">Performing a GET by using a document's ID is an efficient means for retrieving a document, and thus the cost is small.</span></span> <span data-ttu-id="abed4-118">Создание, замена или удаление одного и того же элемента требуют дополнительной обработки службой, а значит, и больше единиц запросов.</span><span class="sxs-lookup"><span data-stu-id="abed4-118">Creating, replacing, or deleting the same item requires additional processing by the service, and therefore requires more request units.</span></span>

<span data-ttu-id="abed4-119">Количество единиц запросов, необходимое для той или иной операции, зависит от размера документа, количества свойств в документе, выполняемой операции и некоторых дополнительных комплексных понятий, таких как согласованность и политика индексирования.</span><span class="sxs-lookup"><span data-stu-id="abed4-119">The number of request units used for an operation changes depending on the document size, the number of properties in the document, the operation being performed, and some additional complex concepts such as consistency and indexing policy.</span></span>

<span data-ttu-id="abed4-120">В представленной ниже таблице показано, сколько единиц запросов требуется для трех различных размеров (1, 4 и 64 КБ) и двух разных уровней производительности (500 операций чтения в секунду + 100 операций записи в секунду и 500 операций чтения в секунду + 500 операций записи в секунду).</span><span class="sxs-lookup"><span data-stu-id="abed4-120">The following table shows the number of request units required for items of three different sizes (1 KB, 4 KB, and 64 KB) and at two different performance levels (500 reads/second + 100 writes/second and 500 reads/second + 500 writes/second).</span></span> <span data-ttu-id="abed4-121">В этом примере настроена согласованность данных на уровне **сеанса**, а политике индексации присвоено значение **Нет**.</span><span class="sxs-lookup"><span data-stu-id="abed4-121">In this example, the data consistency is set to **Session**, and the indexing policy is set to **None**.</span></span>

| <span data-ttu-id="abed4-122">Размер элемента</span><span class="sxs-lookup"><span data-stu-id="abed4-122">Item size</span></span> | <span data-ttu-id="abed4-123">Операций чтения в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-123">Reads/second</span></span> | <span data-ttu-id="abed4-124">Операций записи в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-124">Writes/second</span></span> | <span data-ttu-id="abed4-125">Единиц запросов</span><span class="sxs-lookup"><span data-stu-id="abed4-125">Request units</span></span>
| --- | --- | --- | --- |
| <span data-ttu-id="abed4-126">1 КБ</span><span class="sxs-lookup"><span data-stu-id="abed4-126">1 KB</span></span> | <span data-ttu-id="abed4-127">500</span><span class="sxs-lookup"><span data-stu-id="abed4-127">500</span></span> | <span data-ttu-id="abed4-128">100</span><span class="sxs-lookup"><span data-stu-id="abed4-128">100</span></span> | <span data-ttu-id="abed4-129">(500 * 1) + (100 * 5) = 1000 единиц запросов в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-129">(500 * 1) + (100 * 5) = 1,000 RU/s</span></span>
| <span data-ttu-id="abed4-130">1 КБ</span><span class="sxs-lookup"><span data-stu-id="abed4-130">1 KB</span></span> | <span data-ttu-id="abed4-131">500</span><span class="sxs-lookup"><span data-stu-id="abed4-131">500</span></span> | <span data-ttu-id="abed4-132">500</span><span class="sxs-lookup"><span data-stu-id="abed4-132">500</span></span> | <span data-ttu-id="abed4-133">(500 * 1) + (500 * 5) = 3000 единиц запросов в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-133">(500 * 1) + (500 * 5) = 3,000 RU/s</span></span>
| <span data-ttu-id="abed4-134">4 КБ</span><span class="sxs-lookup"><span data-stu-id="abed4-134">4 KB</span></span> | <span data-ttu-id="abed4-135">500</span><span class="sxs-lookup"><span data-stu-id="abed4-135">500</span></span> | <span data-ttu-id="abed4-136">100</span><span class="sxs-lookup"><span data-stu-id="abed4-136">100</span></span> | <span data-ttu-id="abed4-137">(500 * 1,3) + (100 * 7) = 1350 единиц запросов в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-137">(500 * 1.3) + (100 * 7) = 1,350 RU/s</span></span>
| <span data-ttu-id="abed4-138">4 КБ</span><span class="sxs-lookup"><span data-stu-id="abed4-138">4 KB</span></span> | <span data-ttu-id="abed4-139">500</span><span class="sxs-lookup"><span data-stu-id="abed4-139">500</span></span> | <span data-ttu-id="abed4-140">500</span><span class="sxs-lookup"><span data-stu-id="abed4-140">500</span></span> | <span data-ttu-id="abed4-141">(500 * 1,3) + (500 * 7) = 4150 единиц запросов в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-141">(500 * 1.3) + (500 * 7) = 4,150 RU/s</span></span>
| <span data-ttu-id="abed4-142">64 КБ</span><span class="sxs-lookup"><span data-stu-id="abed4-142">64 KB</span></span> | <span data-ttu-id="abed4-143">500</span><span class="sxs-lookup"><span data-stu-id="abed4-143">500</span></span> | <span data-ttu-id="abed4-144">100</span><span class="sxs-lookup"><span data-stu-id="abed4-144">100</span></span> | <span data-ttu-id="abed4-145">(500 * 10) + (100 * 48) = 9800 единиц запросов в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-145">(500 * 10) + (100 * 48) = 9,800 RU/s</span></span>
| <span data-ttu-id="abed4-146">64 КБ</span><span class="sxs-lookup"><span data-stu-id="abed4-146">64 KB</span></span> | <span data-ttu-id="abed4-147">500</span><span class="sxs-lookup"><span data-stu-id="abed4-147">500</span></span> | <span data-ttu-id="abed4-148">500</span><span class="sxs-lookup"><span data-stu-id="abed4-148">500</span></span> | <span data-ttu-id="abed4-149">(500 * 10) + (500 * 48) = 29 000 единиц запросов в секунду</span><span class="sxs-lookup"><span data-stu-id="abed4-149">(500 * 10) + (500 * 48) = 29,000 RU/s</span></span>
 
<span data-ttu-id="abed4-150">Как видите, чем больше элемент и чем больше требуется операций чтения и записи, тем больше единиц запросов необходимо резервировать.</span><span class="sxs-lookup"><span data-stu-id="abed4-150">As you can see, the larger the item is, and the more reads and writes are required, the more request units you need to reserve.</span></span> <span data-ttu-id="abed4-151">Оценить пропускную способность, необходимую для приложения, позволяет Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) — это интерактивный инструмент, куда можно загрузить образец JSON-документа, задав необходимое число операций в секунду.</span><span class="sxs-lookup"><span data-stu-id="abed4-151">If you need to estimate the throughput needs of an application, the Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) is an online tool that enables you to upload a sample JSON document and set the number of operations you need to complete per second.</span></span> <span data-ttu-id="abed4-152">После этого он покажет, какой объем нужно зарезервировать.</span><span class="sxs-lookup"><span data-stu-id="abed4-152">It then provides an estimated total to reserve.</span></span>

## <a name="exceeding-throughput-limits"></a><span data-ttu-id="abed4-153">Превышение ограничений пропускной способности</span><span class="sxs-lookup"><span data-stu-id="abed4-153">Exceeding throughput limits</span></span>

<span data-ttu-id="abed4-154">Если вы не зарезервировали достаточное количество единиц запросов, но пытаетесь прочитать или записать больше данных, чем позволяет подготовленная пропускная способность, ваш запрос будет ограничен по скорости.</span><span class="sxs-lookup"><span data-stu-id="abed4-154">If you don’t reserve enough request units, and you attempt to read or write more data than your provisioned throughput allows, your request will be rate-limited.</span></span> <span data-ttu-id="abed4-155">Когда запрос ограничивается по времени, попытка выполнения этого запроса повторяется после заданного периода времени.</span><span class="sxs-lookup"><span data-stu-id="abed4-155">When a request is rate-limited, the request has to be retried again after a specified interval.</span></span> <span data-ttu-id="abed4-156">Если используется пакет SDK для .NET, запрос будет повторен автоматически по прошествии времени, указанного в заголовке Retry-After.</span><span class="sxs-lookup"><span data-stu-id="abed4-156">If you use the .NET SDK, the request will be retried automatically after waiting the amount of time specified in the retry-after header.</span></span>

## <a name="creating-an-account-built-to-scale"></a><span data-ttu-id="abed4-157">Создание учетной записи с поддержкой масштабирования</span><span class="sxs-lookup"><span data-stu-id="abed4-157">Creating an account built to scale</span></span>

<span data-ttu-id="abed4-158">Количество единиц запросов, подготовленное для базы данных, можно изменить в любое время.</span><span class="sxs-lookup"><span data-stu-id="abed4-158">You can change the number of request units provisioned to a database at any time.</span></span> <span data-ttu-id="abed4-159">Это значит, что в периоды высокой нагрузки пропускную способность можно повысить, а в периоды спада — уменьшить, чтобы снизить расходы.</span><span class="sxs-lookup"><span data-stu-id="abed4-159">So, during heavy volume periods, you can scale up to accommodate those high demands, and then reduce provisioned throughput during off peak times to reduce costs.</span></span>

<span data-ttu-id="abed4-160">При создании учетной записи можно подготовить на портале от 400 до более чем 250 000 ЕЗ/с.</span><span class="sxs-lookup"><span data-stu-id="abed4-160">When you create an account, you can provision a minimum of 400 RU/s, or a maximum of 250,000 RU/s in the portal.</span></span> <span data-ttu-id="abed4-161">Если вам нужна более высокая пропускная способность, заполните соответствующий запрос на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="abed4-161">If you need even more throughput, fill out a ticket in the Azure portal.</span></span> <span data-ttu-id="abed4-162">Практически для всех учетных записей рекомендуется задавать первоначальную пропускную способность на уровне 1000 ЕЗ/с — это минимальное значение, которое обеспечит автомасштабирование вашей базы данных, если вам потребуется больше 10 ГБ хранилища.</span><span class="sxs-lookup"><span data-stu-id="abed4-162">Setting the initial throughput to 1000 RU/s is recommended for almost all accounts, as it is the minimum value in which your database will autoscale should you need more than 10 GB of storage.</span></span> <span data-ttu-id="abed4-163">Если начальная пропуская способность будет меньше 1000 ЕЗ/с, ваша база данных не сможет превысить 10 ГБ, пока вы не подготовите базу данных и не укажете ключ секции.</span><span class="sxs-lookup"><span data-stu-id="abed4-163">If you set the initial throughput to any value less than 1000 RU/s, your database will not be able to scale to larger than 10 GB unless you reprovision the database and provide a partition key.</span></span> <span data-ttu-id="abed4-164">Ключи секций позволяют выполнять быстрый поиск данных в Azure Cosmos DB и при необходимости включать автоматическое масштабирование базы данных.</span><span class="sxs-lookup"><span data-stu-id="abed4-164">Partition keys enable quick lookup of data in Azure Cosmos DB and enable it to autoscale your database when needed.</span></span> <span data-ttu-id="abed4-165">Ключи секций рассматриваются в следующем блоке.</span><span class="sxs-lookup"><span data-stu-id="abed4-165">Partition keys are discussed in the next unit.</span></span>

## <a name="summary"></a><span data-ttu-id="abed4-166">Сводка</span><span class="sxs-lookup"><span data-stu-id="abed4-166">Summary</span></span>

<span data-ttu-id="abed4-167">Теперь вы знаете, как оценивать и изменять пропускную способность для Azure Cosmos DB, используя единицы запросов.</span><span class="sxs-lookup"><span data-stu-id="abed4-167">You now understand how to estimate and scope throughput for an Azure Cosmos DB using request units.</span></span> <span data-ttu-id="abed4-168">Единицы запросов можно изменить в любое время и в случае, если при создании учетной записи вы укажете 1000 ЕЗ/с, база данных впоследствии сможет изменить масштаб.</span><span class="sxs-lookup"><span data-stu-id="abed4-168">Request units can be modified at any time, and setting them to 1000 RU/s when you create an account helps ensure your database is ready to scale later.</span></span>