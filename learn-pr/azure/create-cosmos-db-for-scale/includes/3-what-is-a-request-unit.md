Далее мы рассмотрим пропускную способность данных для нашей базы данных. Необходимо следить за тем, чтобы объем транзакций, необходимый для нашей компании, был нам по плечу. Требования к пропускной способности могут варьироваться. Например, в сезон распродаж и праздников пропускная способность веб-сайта электронного магазина должна увеличиваться. Для начала оценим требования к пропускной способности вашей базы данных.

## <a name="what-is-database-throughput"></a>Что такое пропускная способность базы данных? 

Пропускная способность базы данных — это количество операций чтения и записи, которые база данных может выполнить за одну секунду. 

Для стратегического масштабирования пропускной способности оцените свои потребности в пропускной способности, определив, какой объем операций чтения и записи вам нужно будет поддерживать в различное время и с различными размерами документов. Если оценка будет верной, ваши пользователи останутся довольны даже во время пиковых нагрузок. Неверная оценка может привести к ограничению запросов по времени, к задержке и повторению операций, вызвав, таким образом, высокую задержку и недовольство клиентов.

## <a name="what-is-a-request-unit"></a>Что такое единица запроса?

Azure Cosmos DB измеряет пропускную способность, используя так называемую **единицу запроса (ЕЗ)**. Измеряется число единиц запросов в секунду, поэтому единицей измерения служит число **единиц запроса в секунду (ЕЗ/с)**. Количество ЕЗ/с, к которому должно быть готово решение Azure Cosmos DB, необходимо зарезервировать заранее, чтобы оно могло справиться с рассчитанной вами нагрузкой; значение ЕЗ/с можно увеличить или уменьшить в любое время в зависимости от текущих нужд.

## <a name="request-unit-basics"></a>Основные сведения о единицах запросов

Одна единица запроса (1 ЕЗ) равна примерной стоимости выполнения одного запроса GET для документа размером 1 КБ по идентификатору документа. Выполнение запроса GET по идентификатору документа — эффективный способ извлечения документа, а значит, его стоимость будет невелика. Создание, замена или удаление одного и того же элемента требуют дополнительной обработки службой, а значит, и больше единиц запросов.

Количество единиц запросов, необходимое для той или иной операции, зависит от размера документа, количества свойств в документе, выполняемой операции и некоторых дополнительных комплексных понятий, таких как согласованность и политика индексирования.

В представленной ниже таблице показано, сколько единиц запросов требуется для трех различных размеров (1, 4 и 64 КБ) и двух разных уровней производительности (500 операций чтения в секунду + 100 операций записи в секунду и 500 операций чтения в секунду + 500 операций записи в секунду). В этом примере настроена согласованность данных на уровне **сеанса**, а политике индексации присвоено значение **Нет**.

| Размер элемента | Операций чтения в секунду | Операций записи в секунду | Единиц запросов
| --- | --- | --- | --- |
| 1 КБ | 500 | 100 | (500 * 1) + (100 * 5) = 1000 единиц запросов в секунду
| 1 КБ | 500 | 500 | (500 * 1) + (500 * 5) = 3000 единиц запросов в секунду
| 4 КБ | 500 | 100 | (500 * 1,3) + (100 * 7) = 1350 единиц запросов в секунду
| 4 КБ | 500 | 500 | (500 * 1,3) + (500 * 7) = 4150 единиц запросов в секунду
| 64 КБ | 500 | 100 | (500 * 10) + (100 * 48) = 9800 единиц запросов в секунду
| 64 КБ | 500 | 500 | (500 * 10) + (500 * 48) = 29 000 единиц запросов в секунду
 
Как видите, чем больше элемент и чем больше требуется операций чтения и записи, тем больше единиц запросов необходимо резервировать. Оценить пропускную способность, необходимую для приложения, позволяет Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) — это интерактивный инструмент, куда можно загрузить образец JSON-документа, задав необходимое число операций в секунду. После этого он покажет, какой объем нужно зарезервировать.

## <a name="exceeding-throughput-limits"></a>Превышение ограничений пропускной способности

Если вы не зарезервировали достаточное количество единиц запросов, но пытаетесь прочитать или записать больше данных, чем позволяет подготовленная пропускная способность, ваш запрос будет ограничен по скорости. Когда запрос ограничивается по времени, попытка выполнения этого запроса повторяется после заданного периода времени. Если используется пакет SDK для .NET, запрос будет повторен автоматически по прошествии времени, указанного в заголовке Retry-After.

## <a name="creating-an-account-built-to-scale"></a>Создание учетной записи с поддержкой масштабирования

Количество единиц запросов, подготовленное для базы данных, можно изменить в любое время. Это значит, что в периоды высокой нагрузки пропускную способность можно повысить, а в периоды спада — уменьшить, чтобы снизить расходы.

При создании учетной записи можно подготовить на портале от 400 до более чем 250 000 ЕЗ/с. Если вам нужна более высокая пропускная способность, заполните соответствующий запрос на портале Azure. Практически для всех учетных записей рекомендуется задавать первоначальную пропускную способность на уровне 1000 ЕЗ/с — это минимальное значение, которое обеспечит автомасштабирование вашей базы данных, если вам потребуется больше 10 ГБ хранилища. Если начальная пропуская способность будет меньше 1000 ЕЗ/с, ваша база данных не сможет превысить 10 ГБ, пока вы не подготовите базу данных и не укажете ключ секции. Ключи секций позволяют выполнять быстрый поиск данных в Azure Cosmos DB и при необходимости включать автоматическое масштабирование базы данных. Ключи секций рассматриваются в следующем блоке.

## <a name="summary"></a>Сводка

Теперь вы знаете, как оценивать и изменять пропускную способность для Azure Cosmos DB, используя единицы запросов. Единицы запросов можно изменить в любое время и в случае, если при создании учетной записи вы укажете 1000 ЕЗ/с, база данных впоследствии сможет изменить масштаб.