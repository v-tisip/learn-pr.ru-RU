<span data-ttu-id="4cde6-101">Розничный интернет-магазин, в котором вы работаете, в ближайшем будущем планирует выйти в новый регион.</span><span class="sxs-lookup"><span data-stu-id="4cde6-101">The online retailer that you work for plans to expand to a new geographical area in the near future.</span></span> <span data-ttu-id="4cde6-102">Расширение приведет к увеличению клиентской базы и объема операций.</span><span class="sxs-lookup"><span data-stu-id="4cde6-102">This move will increase your customer base and transaction volume.</span></span> <span data-ttu-id="4cde6-103">Вам необходимо сделать так, чтобы ваша база данных могла справиться с таким расширением.</span><span class="sxs-lookup"><span data-stu-id="4cde6-103">You must ensure that your database is equipped to handle expansion whenever required.</span></span>

<span data-ttu-id="4cde6-104">Стратегия секционирования позволяет гарантировать, что база данных сможет легко увеличиваться по мере необходимости и продолжать эффективно обрабатывать запросы и транзакции.</span><span class="sxs-lookup"><span data-stu-id="4cde6-104">Having a partition strategy ensures that when your database needs to grow, it can do so easily and continue to perform efficient queries and transactions.</span></span>

## <a name="what-is-a-partition-strategy"></a><span data-ttu-id="4cde6-105">Что такое стратегия секционирования?</span><span class="sxs-lookup"><span data-stu-id="4cde6-105">What is a partition strategy?</span></span>

<span data-ttu-id="4cde6-106">Если продолжать добавлять новые данные на один сервер или в одну секцию, рано или поздно место закончится.</span><span class="sxs-lookup"><span data-stu-id="4cde6-106">If you continue to add new data to a single server or a single partition, it will eventually run out of space.</span></span> <span data-ttu-id="4cde6-107">Чтобы подготовиться к этому, необходимо реализовать стратегию секционирования, предусматривающую **горизонтальное масштабирование**, а не вертикальное.</span><span class="sxs-lookup"><span data-stu-id="4cde6-107">To prepare for this, you need a partitioning strategy to **scale out** instead of up.</span></span> <span data-ttu-id="4cde6-108">Горизонтальное масштабирование позволяет добавлять секции в базу данных, когда это требуется приложению.</span><span class="sxs-lookup"><span data-stu-id="4cde6-108">Scaling out is also called horizontal scaling, and it enables you to add more partitions to your database as your application needs them.</span></span>

<span data-ttu-id="4cde6-109">Стратегия секционирования и горизонтального масштабирования в Azure Cosmos DB основана на ключе секции, значение которого задается во время создания коллекции.</span><span class="sxs-lookup"><span data-stu-id="4cde6-109">The partition and scale-out strategy in Azure Cosmos DB is driven by the partition key, which is a value set when you create a collection.</span></span> <span data-ttu-id="4cde6-110">После того как ключ секции задан, его можно изменить, только повторно создав коллекцию. Поэтому выбор ключа — важное решение, которое следует принимать на ранних этапах процесса разработки.</span><span class="sxs-lookup"><span data-stu-id="4cde6-110">Once the partition key is set, it cannot be changed without recreating the collection, so selecting the right partition key is an important decision to make early in your development process.</span></span>  

<span data-ttu-id="4cde6-111">В этом модуле вы узнаете, как выбрать подходящий ключ секции, который позволит использовать возможности автоматического масштабирования в Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4cde6-111">In this unit, you will learn how to choose a partition key that's right for your scenario and will take advantage of the autoscaling that Azure Cosmos DB can do for you.</span></span>

## <a name="partition-key-basics"></a><span data-ttu-id="4cde6-112">Основные сведения о ключе секции</span><span class="sxs-lookup"><span data-stu-id="4cde6-112">Partition key basics</span></span>

<span data-ttu-id="4cde6-113">Ключ секции представляет собой часто запрашиваемое значение в базе данных.</span><span class="sxs-lookup"><span data-stu-id="4cde6-113">A partition key represent a value in your database that's frequently queried.</span></span> <span data-ttu-id="4cde6-114">Поэтому для розничного интернет-магазина в его качестве целесообразно использовать, например, идентификатор пользователя или идентификатор товара.</span><span class="sxs-lookup"><span data-stu-id="4cde6-114">So in an online retail scenario, using the UserID or ProductID value as the partition key is a good choice.</span></span> <span data-ttu-id="4cde6-115">Идентификатор пользователя является хорошим выбором по той причине, что приложению часто необходимо получать, помимо прочего, параметры персонализации, сведения о корзине, журнал заказов и данные профиля.</span><span class="sxs-lookup"><span data-stu-id="4cde6-115">UserID is a good choice, as your application frequently needs to retrieve the personalization settings, shopping cart, order history, and profile information for the user, just to name a few.</span></span> <span data-ttu-id="4cde6-116">Идентификатор товара — также неплохой выбор, так как приложению требуется запрашивать уровень запасов, стоимость доставки, варианты расцветки, расположение складов и т. д.</span><span class="sxs-lookup"><span data-stu-id="4cde6-116">ProductID is also a good choice, as your application needs to query inventory levels, shipping costs, color options, warehouse locations, and more.</span></span>

<span data-ttu-id="4cde6-117">Ключ секции должен обеспечивать распределение операций по базе данных.</span><span class="sxs-lookup"><span data-stu-id="4cde6-117">A partition key should aim to distribute operations across the database.</span></span> <span data-ttu-id="4cde6-118">Распределять запросы необходимо для того, чтобы избежать образования перегруженных секций.</span><span class="sxs-lookup"><span data-stu-id="4cde6-118">You want to distribute requests in an effort to avoid hot partitions.</span></span> <span data-ttu-id="4cde6-119">Перегруженной является такая секция, которая получает гораздо больше запросов, чем другие, из-за чего возникает узкое место.</span><span class="sxs-lookup"><span data-stu-id="4cde6-119">A hot partition is a single partition that receives many more requests than the others, which can create a throughput bottleneck.</span></span> <span data-ttu-id="4cde6-120">Например, для приложения электронной коммерции текущее время плохо подходит в качестве ключа секции, так как все входящие данные будут поступать в одну секцию.</span><span class="sxs-lookup"><span data-stu-id="4cde6-120">For example, for your e-commerce application, the current time would be a poor choice of partition key, because all the incoming data would go to a single partition key.</span></span> <span data-ttu-id="4cde6-121">Идентификатор пользователя или товара подойдет лучше, так как все пользователи вашего сайта, скорее всего, будут добавлять и обновлять данные корзины и профиля приблизительно с одинаковой частотой, благодаря чему операции чтения и записи будут распределяться по всем секциям.</span><span class="sxs-lookup"><span data-stu-id="4cde6-121">UserID or ProductID would be better, as all the users on your site would likely be adding and updating their shopping cart or profile information at about the same frequency, which distributes the reads and writes across all the user partitions.</span></span> <span data-ttu-id="4cde6-122">Изменения сведений о товарах также будут происходить достаточно равномерно.</span><span class="sxs-lookup"><span data-stu-id="4cde6-122">Likewise, updates to product data would also likely be fairly evenly distributed, making ProductID a good partition key choice.</span></span>

<span data-ttu-id="4cde6-123">Каждый ключ секции имеет максимальное пространство для хранения, равное 10 ГБ. Это размер одной физической секции в Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4cde6-123">Each partition key has a maximum storage space of 10 GB, which is the size of one physical partition in Azure Cosmos DB.</span></span> <span data-ttu-id="4cde6-124">Поэтому если размер одной записи с идентификатором пользователя или товара может превышать 10 ГБ, рекомендуем использовать составной ключ.</span><span class="sxs-lookup"><span data-stu-id="4cde6-124">So if your single UserID or ProductID record is going to be larger than 10 GB, think about using a composite key instead so that each record is smaller.</span></span> <span data-ttu-id="4cde6-125">Примером составного ключа может быть запись типа "ИДПользователя-дата" со значением "ИмяКлиента-08072018".</span><span class="sxs-lookup"><span data-stu-id="4cde6-125">An example of a composite key would be UserID-date, which would look like CustomerName-08072018.</span></span> <span data-ttu-id="4cde6-126">При таком подходе можно создавать новую секцию для каждого дня, в который пользователь посетил сайт.</span><span class="sxs-lookup"><span data-stu-id="4cde6-126">This composite key approach would enable you to create a new partition for each day a user visited the site.</span></span>

## <a name="best-practices"></a><span data-ttu-id="4cde6-127">Рекомендации</span><span class="sxs-lookup"><span data-stu-id="4cde6-127">Best practices</span></span>

<span data-ttu-id="4cde6-128">Если вы пытаетесь определить подходящий ключ секции, но решение неочевидно, следуйте приведенным ниже советам.</span><span class="sxs-lookup"><span data-stu-id="4cde6-128">When you're trying to determine the right partition key and the solution isn't obvious, here are a few tips to keep in mind.</span></span>

* <span data-ttu-id="4cde6-129">Не бойтесь использовать слишком много ключей секций.</span><span class="sxs-lookup"><span data-stu-id="4cde6-129">Don’t be afraid of having too many partition keys.</span></span> <span data-ttu-id="4cde6-130">Чем больше ключей, тем выше масштабируемость.</span><span class="sxs-lookup"><span data-stu-id="4cde6-130">The more partition keys you have, the more scalability you have.</span></span>

* <span data-ttu-id="4cde6-131">Чтобы выбрать оптимальный ключ секции для рабочей нагрузки с высокой интенсивностью чтения, обратите внимание на три-пять самых часто используемых запросов.</span><span class="sxs-lookup"><span data-stu-id="4cde6-131">To determine the best partition key for a read-heavy workload, review the top three to five queries you plan on using.</span></span> <span data-ttu-id="4cde6-132">Значение, которое чаще всего включается в предложение WHERE, — подходящий претендент.</span><span class="sxs-lookup"><span data-stu-id="4cde6-132">The value most frequently included in the WHERE clause is a good candidate for the partition key.</span></span>

* <span data-ttu-id="4cde6-133">Для рабочих нагрузок с высокой интенсивностью записи необходимо проанализировать их потребности в обработке транзакций, так как ключ секции входит в область транзакций с несколькими документами.</span><span class="sxs-lookup"><span data-stu-id="4cde6-133">For write-heavy workloads, you'll need to understand the transactional needs of your workload, because the partition key is the scope of multi-document transactions.</span></span>
