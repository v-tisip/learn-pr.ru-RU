<span data-ttu-id="1cdc6-101">Предположим, вы планируете архитектуру приложения для обмена музыкой.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-101">Suppose you are planning the architecture for your music-sharing application.</span></span> <span data-ttu-id="1cdc6-102">Вам необходимо обеспечить надежную передачу музыкальных файлов из мобильного приложения в веб-API.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-102">You want to choose ensure that music files are uploaded to the web API reliably from the mobile app.</span></span>

<span data-ttu-id="1cdc6-103">Определив, что взаимодействие должно осуществляться в форме сообщений, вам следует выбрать для использования очереди службы хранилища Azure или Служебную шину. Оба этих решения можно применять для хранения очередей сообщений, ожидающих обработки.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-103">Having understood that this communication should be a message, you must choose whether to use Azure Storage queues or Service Bus, both of which can be used to store queues of messages as they await processing.</span></span>

## <a name="delivery-guarantees"></a><span data-ttu-id="1cdc6-104">Гарантии доставки</span><span class="sxs-lookup"><span data-stu-id="1cdc6-104">Delivery Guarantees</span></span>

<span data-ttu-id="1cdc6-105">Системы очередей обычно гарантируют доставку каждого сообщения в очереди компоненту-получателю.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-105">Queuing systems usually guarantee delivery of each message in the queue to a destination component.</span></span> <span data-ttu-id="1cdc6-106">Однако для этого могут применяться разные подходы.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-106">However, these guarantees can take different approaches:</span></span>

- <span data-ttu-id="1cdc6-107">**Доставка по крайней мере один раз**.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-107">**At-Least-Once Delivery.**</span></span> <span data-ttu-id="1cdc6-108">При таком подходе каждое сообщение гарантированно доставляется по крайней мере одному из компонентов, получающему сообщения из очереди.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-108">In this approach, each message is guaranteed to be delivered to at least one of the components that retrieve messages from the queue.</span></span> <span data-ttu-id="1cdc6-109">Однако имейте в виду, что в некоторых ситуациях одно и то же сообщение может доставляться несколько раз.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-109">Note, however, that in certain circumstances, it is possible that the same message may be delivered more than once.</span></span> <span data-ttu-id="1cdc6-110">Например, если два экземпляра веб-приложения получают сообщения из очереди, обычно каждое сообщение передается только одному из них.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-110">For example, if there are two instances of a web app retrieving messages from a queue, ordinarily each message goes to only one of those instances.</span></span> <span data-ttu-id="1cdc6-111">Однако если этот экземпляр обрабатывает сообщение слишком долго и время ожидания истекает, сообщение может быть отправлено также и второму.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-111">However, if one instance takes a long time to process the message, and a time-out expires, the message may be sent to the other instance as well.</span></span> <span data-ttu-id="1cdc6-112">Это следует учитывать при написании кода веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-112">Your web app code should be designed with this possibility in mind.</span></span>
- <span data-ttu-id="1cdc6-113">**Доставка не более одного раза**.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-113">**At-Most-Once Delivery.**</span></span> <span data-ttu-id="1cdc6-114">При таком подходе доставка каждого сообщения не гарантируется. Существует очень небольшая вероятность того, что оно не поступит.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-114">In this approach, each message is not guaranteed to be delivered and there is a very small chance that it may not arrive.</span></span> <span data-ttu-id="1cdc6-115">Однако одно и то же сообщение не может быть доставлено дважды, как в случае с доставкой по крайней мере один раз.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-115">However, there is no chance that the message will be delivered twice as with At-Least-Once delivery.</span></span>
- <span data-ttu-id="1cdc6-116">**В порядке поступления (FIFO)**.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-116">**First-In-First-Out (FIFO).**</span></span> <span data-ttu-id="1cdc6-117">В большинстве систем обмена сообщениями сообщения обычно покидают очередь в том же порядке, в котором они были добавлены. Однако необходимо убедиться в том, что такая очередность гарантирована.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-117">In most messaging system, messages usually leave the queue in the same order in which they were added but you should consider whether this order is guaranteed.</span></span> <span data-ttu-id="1cdc6-118">Если ваше распределенное приложение требует, чтобы сообщения обрабатывались именно в таком порядке, следует выбрать систему очередей, дающую гарантию обработки FIFO.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-118">If your distributed application requires that messages are processed in precisely the correct order, you must choose a queue system that includes a FIFO guarantee.</span></span>

## <a name="transactions"></a><span data-ttu-id="1cdc6-119">Транзакции</span><span class="sxs-lookup"><span data-stu-id="1cdc6-119">Transactions</span></span>

<span data-ttu-id="1cdc6-120">Если несколько сообщений тесно связаны между собой, сбой доставки одного из них может вызвать проблемы.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-120">Some closely related groups of messages may cause problems when delivery fails for one message in the group.</span></span>

<span data-ttu-id="1cdc6-121">Возьмем для примера приложение электронной коммерции.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-121">For example, consider an e-commerce application.</span></span> <span data-ttu-id="1cdc6-122">Когда пользователь нажимает кнопку "Купить", вместе с сообщением со сведениями о заказе отправляется сообщение с данными кредитной карты.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-122">When the user clicks the "Buy" button, a message with the order details is sent along with a message with the credit card details.</span></span> <span data-ttu-id="1cdc6-123">Если сообщение с данными кредитной карты не было доставлено, заказ может быть отправлен без оплаты.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-123">If the credit card message is not delivered, the order may be dispatched without payment.</span></span>

<span data-ttu-id="1cdc6-124">Чтобы избежать подобных проблем, можно объединить сообщения в транзакцию.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-124">You can avoid these kinds of problems by grouping the two messages into a transaction.</span></span> <span data-ttu-id="1cdc6-125">Транзакция завершается успешно или неудачно как одно целое.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-125">Transactions succeed or fail as a single unit.</span></span> <span data-ttu-id="1cdc6-126">Если сообщение с данными кредитной карты доставить не удается, то же самое происходит и с сообщением со сведениями о заказе.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-126">If the credit card details message delivery fails then so will the order details message.</span></span>

## <a name="when-to-use-storage-queues"></a><span data-ttu-id="1cdc6-127">Когда следует использовать очереди службы хранилища</span><span class="sxs-lookup"><span data-stu-id="1cdc6-127">When to use Storage queues</span></span>

<span data-ttu-id="1cdc6-128">Очереди применяются для сообщений, но не для событий.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-128">Queues are used for messages but not events.</span></span>

<span data-ttu-id="1cdc6-129">Учетные записи хранения Azure включают в себя очереди, которые могут использоваться распределенными приложениями в качестве простого временного хранилища сообщений.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-129">Azure Storage Accounts include queues, which can be used by distributed applications as simple temporary storage locations for messages.</span></span> <span data-ttu-id="1cdc6-130">Компонент-источник может добавить сообщение в очередь.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-130">A source component can add a message to the queue.</span></span> <span data-ttu-id="1cdc6-131">Компоненты-получатели извлекают сообщение для обработки из начала очереди.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-131">Destination components retrieve the message at the front of the queue for processing.</span></span> <span data-ttu-id="1cdc6-132">Такие очереди повышают надежность обмена сообщениями, так как во время высокой загрузки сообщения могут ожидать, пока компонент-получатель будет готов обработать их.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-132">Such queues increase the reliability of the message exchange because, at times of high demand, messages can simply wait until a destination component is ready to process them.</span></span>

<span data-ttu-id="1cdc6-133">Очереди также предоставляются в рамках системы обмена сообщениями Служебной шины.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-133">Queues are also provided as part of Azure Service Bus Messaging.</span></span> <span data-ttu-id="1cdc6-134">Если вы решили использовать очередь в Azure для определенного взаимодействия, следует выбрать, что подходит лучше: очередь службы хранилища или очередь Служебной шины.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-134">If you have decided to use a queue in Azure for a specific communication, you must decide whether to use a Storage queue or a Service Bus queue.</span></span>

<span data-ttu-id="1cdc6-135">Чтобы сделать правильный выбор, ответьте на приведенные ниже вопросы.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-135">To make this choice, consider the following questions:</span></span>

- <span data-ttu-id="1cdc6-136">Требуется ли гарантия доставки не более одного раза?</span><span class="sxs-lookup"><span data-stu-id="1cdc6-136">Do you need an At-Most-Once delivery guarantee?</span></span>
- <span data-ttu-id="1cdc6-137">Требуется ли гарантия доставки в порядке FIFO?</span><span class="sxs-lookup"><span data-stu-id="1cdc6-137">Do you need a FIFO guarantee?</span></span>
- <span data-ttu-id="1cdc6-138">Нужно ли объединять сообщения в транзакции?</span><span class="sxs-lookup"><span data-stu-id="1cdc6-138">Do you need to group messages into transactions?</span></span>
- <span data-ttu-id="1cdc6-139">Нужно ли хранить сообщения размером более 64 КБ?</span><span class="sxs-lookup"><span data-stu-id="1cdc6-139">Do you need to store messages larger than 64KB?</span></span>

<span data-ttu-id="1cdc6-140">Если ответ на какие-либо из этих вопросов утвердительный, следует выбрать очередь Служебной шины.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-140">If the answer to any of these questions is yes, you must choose to use a Service Bus queue.</span></span>

<span data-ttu-id="1cdc6-141">Кроме того, ответьте на приведенные ниже вопросы.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-141">In addition consider:</span></span>

- <span data-ttu-id="1cdc6-142">Требуются ли журналы всех сообщений, проходящих через очередь, на стороне сервера?</span><span class="sxs-lookup"><span data-stu-id="1cdc6-142">Do you need server-side logs of all messages that pass through the queue?</span></span>
- <span data-ttu-id="1cdc6-143">Может ли размер очереди превышать 80 ГБ?</span><span class="sxs-lookup"><span data-stu-id="1cdc6-143">Do you expect the queue to exceed 80GB in size?</span></span>

<span data-ttu-id="1cdc6-144">Если ответ на какие-либо из этих вопросов утвердительный, следует выбрать очередь службы хранилища.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-144">If the answer to any of these questions is yes, you must choose to use a Storage queue.</span></span>

## <a name="summary"></a><span data-ttu-id="1cdc6-145">Сводка</span><span class="sxs-lookup"><span data-stu-id="1cdc6-145">Summary</span></span>

<span data-ttu-id="1cdc6-146">Очередь — это простое временное хранилище сообщений, передаваемых между компонентами распределенного приложения.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-146">A queue is a simple temporary storage location for messages sent between the components of a distributed application.</span></span> <span data-ttu-id="1cdc6-147">Она позволяет упорядочивать сообщения и справляться с неожиданными скачками нагрузки.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-147">Use a queue to organize message and gracefully handle unpredictable surges in demand.</span></span>

<span data-ttu-id="1cdc6-148">Используйте очереди службы хранилища Azure, если вам нужна простая и легко программируемая система очередей.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-148">Use Azure Storage queues when you want a simple and easy-to-code queue system.</span></span> <span data-ttu-id="1cdc6-149">Для более сложных случаев используйте очереди Служебной шины Azure.</span><span class="sxs-lookup"><span data-stu-id="1cdc6-149">For more advanced needs, use Azure Service Bus queues.</span></span>