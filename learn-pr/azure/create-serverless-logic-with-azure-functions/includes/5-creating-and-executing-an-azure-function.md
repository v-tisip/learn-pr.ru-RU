<span data-ttu-id="76e27-101">Теперь, когда у нас есть созданное приложение-функция, мы узнаем, как создавать, настраивать и выполнять функцию Azure.</span><span class="sxs-lookup"><span data-stu-id="76e27-101">Now that we have a function app created, we'll learn how to build, configure and execute an Azure function.</span></span>

### <a name="triggers"></a><span data-ttu-id="76e27-102">Триггеры</span><span class="sxs-lookup"><span data-stu-id="76e27-102">Triggers</span></span>
<span data-ttu-id="76e27-103">Функции Azure управляются событиями и выполняются в ответ на событие, такое как получение HTTP-запроса или добавление сообщения в очередь.</span><span class="sxs-lookup"><span data-stu-id="76e27-103">Azure functions are event driven and execute in response to an event, such as receiving an HTTP request or a message being added to a queue.</span></span> 

<span data-ttu-id="76e27-104">Тип события, которое инициирует функцию, называется триггером.</span><span class="sxs-lookup"><span data-stu-id="76e27-104">The type of event that initiates the function is called a trigger.</span></span> <span data-ttu-id="76e27-105">Функциям Azure для настройки требуется хотя бы один триггер.</span><span class="sxs-lookup"><span data-stu-id="76e27-105">Azure functions require at least one trigger to be configured.</span></span> <span data-ttu-id="76e27-106">В противном случае у нас не будет возможности запустить функцию.</span><span class="sxs-lookup"><span data-stu-id="76e27-106">Otherwise we'd have no way of running the function.</span></span>

 <span data-ttu-id="76e27-107">Azure поддерживает широкий ряд триггеров, в том числе:</span><span class="sxs-lookup"><span data-stu-id="76e27-107">Azure supports a wide range of triggers, including:</span></span>
* <span data-ttu-id="76e27-108">HTTPTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-108">HTTPTrigger</span></span>
* <span data-ttu-id="76e27-109">TimerTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-109">TimerTrigger</span></span>
* <span data-ttu-id="76e27-110">Веб-перехватчик GitHub</span><span class="sxs-lookup"><span data-stu-id="76e27-110">GitHub webhook</span></span>
* <span data-ttu-id="76e27-111">CosmosDBTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-111">CosmosDBTrigger</span></span>
* <span data-ttu-id="76e27-112">BlobTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-112">BlobTrigger</span></span>
* <span data-ttu-id="76e27-113">QueueTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-113">QueueTrigger</span></span>
* <span data-ttu-id="76e27-114">EventHubTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-114">EventHubTrigger</span></span>
* <span data-ttu-id="76e27-115">ServiceBusQueueTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-115">ServiceBusQueueTrigger</span></span>
* <span data-ttu-id="76e27-116">ServiceBusTopicTrigger</span><span class="sxs-lookup"><span data-stu-id="76e27-116">ServiceBusTopicTrigger</span></span>

### <a name="bindings"></a><span data-ttu-id="76e27-117">Привязки</span><span class="sxs-lookup"><span data-stu-id="76e27-117">Bindings</span></span>
<span data-ttu-id="76e27-118">Привязки функций Azure — это декларативный способ подключения данных к функции программными средствами.</span><span class="sxs-lookup"><span data-stu-id="76e27-118">Azure function bindings are a declarative way to connect to data to your function programmatically.</span></span>

<span data-ttu-id="76e27-119">Привязки — это подключение к службам данных.</span><span class="sxs-lookup"><span data-stu-id="76e27-119">Bindings are the connection to your data services.</span></span> <span data-ttu-id="76e27-120">Функция Azure без привязок, с одной или несколькими привязками позволяет получить доступ к нескольким источникам данных.</span><span class="sxs-lookup"><span data-stu-id="76e27-120">An Azure function with zero, one or more bindings allows you to access multiple data sources.</span></span> <span data-ttu-id="76e27-121">Вы определяете их как входные или выходные привязки или привязки чтения или записи.</span><span class="sxs-lookup"><span data-stu-id="76e27-121">You also define them as input or output bindings, or you can think of them as read or write bindings.</span></span>

<span data-ttu-id="76e27-122">Предположим, у вас есть QueueTrigger, который запускает функцию, если в очередь добавляется большой двоичный объект.</span><span class="sxs-lookup"><span data-stu-id="76e27-122">Suppose you had a QueueTrigger that initiates a function when a blob is added to a queue.</span></span> <span data-ttu-id="76e27-123">Для подключения к хранилищу BLOB-объектов Azure используется входная привязка большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="76e27-123">An input blob binding would be used to connect to Azure Blob storage.</span></span> 

<span data-ttu-id="76e27-124">Выходные привязки используются для сохранения данных.</span><span class="sxs-lookup"><span data-stu-id="76e27-124">Output bindings are used to store data.</span></span> <span data-ttu-id="76e27-125">Например, они отправляют возвращаемое значение функции в хранилище таблиц Azure.</span><span class="sxs-lookup"><span data-stu-id="76e27-125">For instance, they send the return value of the function to Azure Table storage.</span></span>

<span data-ttu-id="76e27-126">Полный список доступных привязок доступен в [документации по Azure](https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings#supported-bindings).</span><span class="sxs-lookup"><span data-stu-id="76e27-126">A full list of available bindings is available in the [Azure documentation](https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings#supported-bindings).</span></span>

### <a name="a-sample-trigger-and-binding-functionjson"></a><span data-ttu-id="76e27-127">Пример триггера и привязки (function.json)</span><span class="sxs-lookup"><span data-stu-id="76e27-127">A sample trigger and binding (function.json)</span></span>
<span data-ttu-id="76e27-128">Это пример определения триггера и привязки для функции.</span><span class="sxs-lookup"><span data-stu-id="76e27-128">This is a sample definition of a trigger and binding for a function.</span></span> <span data-ttu-id="76e27-129">Обратите внимание, что, в зависимости от типа привязки, которую вы описываете, необходимо указать различные значения свойств.</span><span class="sxs-lookup"><span data-stu-id="76e27-129">You will note that depending on the type of binding you are describing, there are different property values that need to be set.</span></span> <span data-ttu-id="76e27-130">Каждая привязка также имеет направление, которое определяет, используется она для ввода или для вывода.</span><span class="sxs-lookup"><span data-stu-id="76e27-130">Each binding also has a direction that defines whether it is an input or output binding.</span></span> <span data-ttu-id="76e27-131">Триггеры — это всегда входные привязки.</span><span class="sxs-lookup"><span data-stu-id="76e27-131">Triggers are always input bindings.</span></span> <span data-ttu-id="76e27-132">В этом примере показана функция, которая запускается добавлением сообщения в очередь с именем **myqueue-items**.</span><span class="sxs-lookup"><span data-stu-id="76e27-132">This sample shows a function that is triggered by a message being added to a queue named **myqueue-items**.</span></span> <span data-ttu-id="76e27-133">Затем она отправляет возвращаемое значение функции в таблицу **outTable** в хранилище таблиц Azure.</span><span class="sxs-lookup"><span data-stu-id="76e27-133">It then sends the return value of the function to the **outTable** table in Azure Table storage.</span></span>

```javascript
{
  "bindings": [
    {
      "name": "order",
      "type": "queueTrigger",
      "direction": "in",
      "queueName": "myqueue-items",
      "connection": "MY_STORAGE_ACCT_APP_SETTING"
    },
    {
      "name": "$return",
      "type": "table",
      "direction": "out",
      "tableName": "outTable",
      "connection": "MY_TABLE_STORAGE_ACCT_APP_SETTING"
    }
  ]
}
```
## <a name="premade-functions-and-templates"></a><span data-ttu-id="76e27-134">Готовые функции и шаблоны</span><span class="sxs-lookup"><span data-stu-id="76e27-134">Premade functions and templates</span></span>
<span data-ttu-id="76e27-135">Azure предоставляет предварительно настроенные шаблоны для распространенных сценариев функций Azure.</span><span class="sxs-lookup"><span data-stu-id="76e27-135">Azure provides pre-configured templates for common Azure function scenarios.</span></span>

### <a name="quickstart-templates"></a><span data-ttu-id="76e27-136">Шаблоны быстрого запуска</span><span class="sxs-lookup"><span data-stu-id="76e27-136">Quickstart templates</span></span>
<span data-ttu-id="76e27-137">Чтобы добавить функцию Azure, необходимо выбрать приложение-функцию.</span><span class="sxs-lookup"><span data-stu-id="76e27-137">To add an Azure function, you must select a function app.</span></span> <span data-ttu-id="76e27-138">Приложение-функцию можно определить по значку молнии в остроконечных скобках.</span><span class="sxs-lookup"><span data-stu-id="76e27-138">The function app can be identified by the lightning bolt within pointy brackets icon.</span></span>  
![Значок функции](../images/5-function-icon.png)

<span data-ttu-id="76e27-140">При добавлении первой функции Azure откроется экран быстрого запуска.</span><span class="sxs-lookup"><span data-stu-id="76e27-140">When adding your first Azure function, you are presented with the Quickstart screen.</span></span> <span data-ttu-id="76e27-141">На этом экране можно выбрать необходимый тип триггера и язык программирования.</span><span class="sxs-lookup"><span data-stu-id="76e27-141">This screen allows you to make a selection on your desired trigger type and programming language.</span></span> <span data-ttu-id="76e27-142">Затем Azure автоматически создаст код функции и конфигурацию с учетом выбранных параметров.</span><span class="sxs-lookup"><span data-stu-id="76e27-142">Then, based on your selections, Azure will generate the function code and configuration for you.</span></span>  
![Быстрый запуск функции](../images/5-quickstart-form.png)

### <a name="function-templates"></a><span data-ttu-id="76e27-144">Шаблоны функций</span><span class="sxs-lookup"><span data-stu-id="76e27-144">Function templates</span></span>
<span data-ttu-id="76e27-145">Выбор шаблона не ограничивается представленными на экране быстрого запуска.</span><span class="sxs-lookup"><span data-stu-id="76e27-145">The selection of templates is not limited to those available in the Quickstart.</span></span> <span data-ttu-id="76e27-146">Вы можете выбрать один из более чем 30 шаблонов.</span><span class="sxs-lookup"><span data-stu-id="76e27-146">You also have the option of choosing from over 30 different templates.</span></span> <span data-ttu-id="76e27-147">Вы можете открыть экран списка шаблонов при создании последующих функций или выбрав параметр **Пользовательская функция** на экране быстрого запуска.</span><span class="sxs-lookup"><span data-stu-id="76e27-147">You can access the template list screen while creating subsequent functions, or by selecting the **Custom function** option on the Quickstart screen.</span></span>  
<span data-ttu-id="76e27-148">![Шаблоны функций](../images/5-template-list.png)</span><span class="sxs-lookup"><span data-stu-id="76e27-148">![Function templates](../images/5-template-list.png)</span></span>

## <a name="navigating-to-your-function-and-files"></a><span data-ttu-id="76e27-149">Переход к функции и файлам</span><span class="sxs-lookup"><span data-stu-id="76e27-149">Navigating to your function and files</span></span>
<span data-ttu-id="76e27-150">После создания функции на основе шаблона создается несколько файлов.</span><span class="sxs-lookup"><span data-stu-id="76e27-150">After you create a function from a template, several files are created.</span></span> <span data-ttu-id="76e27-151">Предположим, что вы решили использовать веб-перехватчик + API быстрого запуска с использованием JavaScript.</span><span class="sxs-lookup"><span data-stu-id="76e27-151">Suppose you opted to use the Webhook + API Quickstart using JavaScript.</span></span> <span data-ttu-id="76e27-152">Будут созданы файл конфигурации **function.json** и файл исходного кода **index.js**.</span><span class="sxs-lookup"><span data-stu-id="76e27-152">The files generated would be a configuration file, **function.json**, and a source code file, **index.js**.</span></span> <span data-ttu-id="76e27-153">При доступе к приложению-функции откроется дерево меню с функциями, созданными в приложении.</span><span class="sxs-lookup"><span data-stu-id="76e27-153">When accessing the function app, you will be presented with a menu tree displaying the functions that have been created in the app.</span></span> <span data-ttu-id="76e27-154">В этом меню **Функции** вы также можете добавлять дополнительные функции для приложения-функции (при наведении указателя на элемент меню появится знак плюса "+").</span><span class="sxs-lookup"><span data-stu-id="76e27-154">It is also on this **Functions** menu item that you are able to add additional functions to the function app (a plus + icon will appear when you're hovering over the menu item).</span></span>  
<span data-ttu-id="76e27-155">![Кнопка "Добавить функцию"](../images/5-function-add-button.png)</span><span class="sxs-lookup"><span data-stu-id="76e27-155">![Add Function button](../images/5-function-add-button.png)</span></span> 

<span data-ttu-id="76e27-156">Если вы раскрываете меню **Функции** в представлении в виде дерева на экране быстрого запуска, вы увидите одну функцию с именем по умолчанию **HttpTriggerJS1** (также обозначается значком функции f).</span><span class="sxs-lookup"><span data-stu-id="76e27-156">In the case of this Quickstart mentioned above, when you expand **Functions** in the tree view, you will see one function with a default name of **HttpTriggerJS1** (also indicated by the function f icon).</span></span> <span data-ttu-id="76e27-157">При выборе этой функции откроется окно кода с исходным файлом **index.js**.</span><span class="sxs-lookup"><span data-stu-id="76e27-157">Selecting this function will open up a code window and display the **index.js** source file.</span></span> <span data-ttu-id="76e27-158">Справа от окна кода есть всплывающее меню, которое содержит вкладку **Просмотр файлов**.</span><span class="sxs-lookup"><span data-stu-id="76e27-158">On the right-hand side of the code window, there is a flyout menu that includes a tab to **View files**.</span></span> <span data-ttu-id="76e27-159">Откройте эту вкладку, чтобы просмотреть структуру файлов (соответствующую расположению в хранилище), из которой состоит ваша функция.</span><span class="sxs-lookup"><span data-stu-id="76e27-159">Selecting this tab will show you the file structure (mimicked in storage) that makes up your function.</span></span>  
<span data-ttu-id="76e27-160">![Шаблоны функций](../images/5-file-navigation.png)</span><span class="sxs-lookup"><span data-stu-id="76e27-160">![Function templates](../images/5-file-navigation.png)</span></span>

## <a name="execution-options-for-testing-your-azure-function"></a><span data-ttu-id="76e27-161">Параметры выполнения для тестирования функции Azure</span><span class="sxs-lookup"><span data-stu-id="76e27-161">Execution options for testing your Azure function</span></span>
<span data-ttu-id="76e27-162">После создания функции Azure вам нужно будет узнать, как ее протестировать.</span><span class="sxs-lookup"><span data-stu-id="76e27-162">Once you have an Azure function created, you will need to know how to test it.</span></span> <span data-ttu-id="76e27-163">Существует несколько подходов: выполнение вручную и тестирование на самом портале Azure.</span><span class="sxs-lookup"><span data-stu-id="76e27-163">There are a couple of approaches: manual execution and testing from within the Azure portal itself.</span></span>

### <a name="manual-execution-of-a-function"></a><span data-ttu-id="76e27-164">Выполнение функции вручную</span><span class="sxs-lookup"><span data-stu-id="76e27-164">Manual execution of a function</span></span>
<span data-ttu-id="76e27-165">Вы можете выполнить функцию, вручную запустив настроенный триггер.</span><span class="sxs-lookup"><span data-stu-id="76e27-165">You can initiate the execution of a function by manually triggering the configured trigger.</span></span> <span data-ttu-id="76e27-166">К примеру, если вы используете HttpTrigger, вы можете использовать такое средство, как Postman или cURL, чтобы инициировать HTTP-запрос по URL-адресу конечной точки функции.</span><span class="sxs-lookup"><span data-stu-id="76e27-166">For instance, if you are using an HttpTrigger - you can use a tool such as Postman or cURL to initiate an HTTP request to your function endpoint URL.</span></span>  
<span data-ttu-id="76e27-167">![Выполнение функции с помощью Postman](../images/5-postman-execution.png). URL-адрес конечной точки можно получить, выбрав триггер HTTP в области навигации слева, а затем нажав на кнопку **Получить URL-адрес функции**.</span><span class="sxs-lookup"><span data-stu-id="76e27-167">![Postman execution of a function](../images/5-postman-execution.png) You can obtain the endpoint URL by selecting your HTTP Trigger from the left navigation, and then selecting the **Get function URL** button.</span></span>  
<span data-ttu-id="76e27-168">![Получить URL-адрес функции](../images/5-get-function-url.png)</span><span class="sxs-lookup"><span data-stu-id="76e27-168">![Get function URL](../images/5-get-function-url.png)</span></span>

### <a name="testing-a-function-in-the-azure-portal"></a><span data-ttu-id="76e27-169">Тестирование функции на портале Azure</span><span class="sxs-lookup"><span data-stu-id="76e27-169">Testing a function in the Azure portal</span></span>
<span data-ttu-id="76e27-170">Портал Azure также предоставляет удобный способ для тестирования функций.</span><span class="sxs-lookup"><span data-stu-id="76e27-170">Alternatively, the Azure portal also provides a convenient way to test your functions.</span></span> <span data-ttu-id="76e27-171">В правой части окна кода есть всплывающее меню с вкладками.</span><span class="sxs-lookup"><span data-stu-id="76e27-171">On the right side of the code window, there is a flyout tabbed navigation menu.</span></span> <span data-ttu-id="76e27-172">В меню есть элемент **Тест**.</span><span class="sxs-lookup"><span data-stu-id="76e27-172">This menu contains a **Test** item.</span></span> <span data-ttu-id="76e27-173">Разверните меню и выберите эту вкладку, чтобы выполнить функцию и посмотреть результат.</span><span class="sxs-lookup"><span data-stu-id="76e27-173">Expanding the menu and selecting this tab gives you another way to execute your function and view the result.</span></span> <span data-ttu-id="76e27-174">Если вы используете триггер HttpTrigger, вы можете задать метод HTTP и добавить в запрос параметры строки запроса и заголовки HTTP.</span><span class="sxs-lookup"><span data-stu-id="76e27-174">In keeping with the HttpTrigger scenario, you can set the HTTP method, and add querystring parameters and HTTP headers to the request.</span></span> <span data-ttu-id="76e27-175">Вы также можете изменить текст запроса для тестирования дополнительных сценариев.</span><span class="sxs-lookup"><span data-stu-id="76e27-175">You may also change the request body to test additional scenarios.</span></span> <span data-ttu-id="76e27-176">В окне вывода отображается результат, возвращаемый функцией.</span><span class="sxs-lookup"><span data-stu-id="76e27-176">The output window shows the result of the function.</span></span>  
<span data-ttu-id="76e27-177">![Выполнение функции на портале](../images/5-portal-execution.png)</span><span class="sxs-lookup"><span data-stu-id="76e27-177">![Portal execution of a function](../images/5-portal-execution.png)</span></span>

## <a name="monitoring-an-azure-function"></a><span data-ttu-id="76e27-178">Мониторинг функции Azure</span><span class="sxs-lookup"><span data-stu-id="76e27-178">Monitoring an Azure function</span></span>
<span data-ttu-id="76e27-179">Во время разработки функции Azure очень важно иметь возможность вносить сообщения в журнал и определять сценарии исключений, чтобы подготовить функции к рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="76e27-179">During Azure function development, being able to log messages and determine exception scenarios is critical to ensuring that you are getting your functions production-ready.</span></span> <span data-ttu-id="76e27-180">Это так же важно в рабочем сценарии, когда вы ищете источник сбоя.</span><span class="sxs-lookup"><span data-stu-id="76e27-180">This is just as important in a production scenario, when you are tracking down the source of a defect.</span></span> <span data-ttu-id="76e27-181">Портал Azure предоставляет пользовательский интерфейс с панелью мониторинга и возможностью просмотра журналов выполнения и исключений, полученных из функций Azure.</span><span class="sxs-lookup"><span data-stu-id="76e27-181">The Azure portal gives us a user interface that provides a monitoring dashboard as well as a way to review execution logs and exceptions obtained from your Azure functions.</span></span>

### <a name="monitoring-dashboard"></a><span data-ttu-id="76e27-182">Панель мониторинга</span><span class="sxs-lookup"><span data-stu-id="76e27-182">Monitoring dashboard</span></span>
<span data-ttu-id="76e27-183">В меню навигации приложения-функции разверните узел функции, и увидите элемент меню **Монитор**.</span><span class="sxs-lookup"><span data-stu-id="76e27-183">In the function app navigation menu, once you expand the function node - you will see a **Monitor** menu item.</span></span> <span data-ttu-id="76e27-184">На панели мониторинга можно быстро просматривать историю выполнений этой функции.</span><span class="sxs-lookup"><span data-stu-id="76e27-184">The monitor dashboard provides a quick way to view the history of function executions.</span></span> <span data-ttu-id="76e27-185">В этом представлении отображаются метки времени, код результата, длительность и идентификатор операции, а также успешность выполнения.</span><span class="sxs-lookup"><span data-stu-id="76e27-185">This view displays the timestamp, result code, duration, and operation ID, as well as if it completed successfully.</span></span> <span data-ttu-id="76e27-186">Данные заполняются с помощью Azure Application Insights.</span><span class="sxs-lookup"><span data-stu-id="76e27-186">The data is populated via Azure Application Insights.</span></span>  
<span data-ttu-id="76e27-187">![Монитор функции](../images/5-monitor-function.png)</span><span class="sxs-lookup"><span data-stu-id="76e27-187">![Function monitor](../images/5-monitor-function.png)</span></span>

### <a name="log-window"></a><span data-ttu-id="76e27-188">Окно журнала</span><span class="sxs-lookup"><span data-stu-id="76e27-188">Log window</span></span>
<span data-ttu-id="76e27-189">Вы можете добавлять в функцию операторы журнала.</span><span class="sxs-lookup"><span data-stu-id="76e27-189">You are also able to add log statements to your function.</span></span> <span data-ttu-id="76e27-190">Эти операторы будут отображаться в окне журнала функции.</span><span class="sxs-lookup"><span data-stu-id="76e27-190">These statements will appear in the log window of the function.</span></span> <span data-ttu-id="76e27-191">Окно журнала находится во всплывающем меню с вкладками, расположенном в нижней части окна кода.</span><span class="sxs-lookup"><span data-stu-id="76e27-191">The log window is located in a tabbed flyout menu located at the bottom of the code window.</span></span> <span data-ttu-id="76e27-192">При использовании функции на базе JavaScript необходимо добавить оператор журнала, используя следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="76e27-192">When using a JavaScript-based function, you would add a log statement using the following syntax:</span></span>
```javascript
  context.log('Enter your logging statement here');
```  
![Окно журнала](../images/5-log-window.png)

### <a name="errors-and-warnings-window"></a><span data-ttu-id="76e27-194">Окно "Ошибки и предупреждения"</span><span class="sxs-lookup"><span data-stu-id="76e27-194">Errors and warnings window</span></span>
<span data-ttu-id="76e27-195">Вкладка "Ошибки и предупреждения" находится в том же всплывающем меню, что и окно журнала.</span><span class="sxs-lookup"><span data-stu-id="76e27-195">You can locate the errors and warnings window tab in the same flyout menu as the log window.</span></span> <span data-ttu-id="76e27-196">В этом окне отображаются ошибки и предупреждения компиляции кода.</span><span class="sxs-lookup"><span data-stu-id="76e27-196">This window will show compilation errors and warnings within your code.</span></span> <span data-ttu-id="76e27-197">Поскольку JavaScript — это динамический и интерпретируемый язык, на следующем изображении показана ошибка компиляции в функции C#.</span><span class="sxs-lookup"><span data-stu-id="76e27-197">As JavaScript is a dynamic and interpreted language, the following image shows a compilation error in a C# function.</span></span>  
![Окно "Ошибки и предупреждения"](../images/5-errors-window.png)
