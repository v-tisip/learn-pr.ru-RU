После создания виртуальной машины мы можем получить интересующие нас сведения о ней с помощью других команд.

Начнем с `vm list`.

```azurecli
az vm list
```

Эта команда возвращает _все_ виртуальные машины, определенные в этой подписке. С помощью параметра `--resource-group` выполняется фильтрация выходных данных для определенной группы ресурсов. 

## <a name="output-types"></a>Типы выходных данных
Обратите внимание, что для всех команд, которые мы рассмотрели, типом ответа по умолчанию является JSON. Он хорошо подходит для сценариев, но большинство пользователей считает его трудночитаемым. Флаг `--output` позволяет изменить стиль выходных данных для любого типа ответа. Например, попробуйте выполнить следующую команду в Azure Cloud Shell, чтобы применить другой стиль выходных данных.

```azurecli
az vm list --output table
```

Вместе с `table` можно указать `json` (по умолчанию), `jsonc` (выделенный цветом JSON) или `tsv` (значения, разделенные табуляцией). Попробуйте несколько вариантов с приведенной выше командой, чтобы увидеть разницу.

## <a name="getting-the-ip-address"></a>Получение IP-адреса

Еще одной полезной командой является `vm list-ip-addresses`, которая выводит список общедоступных и частных IP-адресов для виртуальной машины. Если адреса изменились или вы не записали их во время создания, эту команду можно выполнить в любое время.

```azurecli
az vm list-ip-addresses -n SampleVM -o table
```

Возвращаемые данные:

```
VirtualMachine    PublicIPAddresses    PrivateIPAddresses
----------------  -------------------  --------------------
SampleVM          168.61.54.62         10.0.0.4
```

> [!NOTE]
> Обратите внимание, что мы используем сокращенный синтаксис для флага `--output` — `-o`. Большинство параметров для команд Azure CLI можно сократить до одного дефиса и буквы. Например, `--name` сокращается до `-n`, а `--resource-group` — до `-g`. Это удобно для ввода, но в сценариях для ясности рекомендуется использовать полное имя параметра. Более подробные сведения о каждой команде см. в соответствующей документации.

## <a name="getting-vm-details"></a>Получение сведений о виртуальной машине

С помощью команды `vm show` можно получить более подробные сведения о конкретной виртуальной машине по ее имени или идентификатору.

```azurecli
az vm show --resource-group ExerciseResources --name SampleVM
```

Эта команда возвращает довольно большой блок JSON с различными сведениями о виртуальной машине, в том числе подключенные устройства хранения, сетевые интерфейсы и все идентификаторы объектов для ресурсов, к которым подключена виртуальная машина. Опять же, можно изменить формат на табличный, но в этом случае будут пропущены все интересующие нас данные. Поэтому перейдем к языку встроенных запросов для JSON, который называется [JMESPath](http://jmespath.org/).

## <a name="adding-filters-to-queries-with-jmespath"></a>Добавление фильтров в запросы с помощью JMESPath

JMESPath — это соответствующий отраслевым стандартам язык запросов, созданный на основе объектов JSON. Самым простым запросом является указание _идентификатора_, который выбирает ключ в объекте JSON.

Предположим, что есть объект:

```json
{
  "people": [
    {
      "name": "Fred",
      "age": 28
    },
    {
      "name": "Barney",
      "age": 25
    },
    {
      "name": "Wilma",
      "age": 27
    }
  ]
}
```

С помощью запроса `people` можно вернуть массив значений для массива `people`. Если нам нужен только _один_ человек, можно использовать индексатор. Например, `people[1]` возвращает:

```json
{
    "name": "Barney",
    "age": 25
}
```

Мы также можем добавить определенные квалификаторы, которые возвратят подмножество объектов на основе определенных критериев. Например, при добавлении квалификатора `people[?age > '25']` возвращается:

```json
[
  {
    "name": "Fred",
    "age": 28
  },
  {
    "name": "Wilma",
    "age": 27
  }
]
```

Наконец, ограничим результаты, добавив select: `people[?age > '25'].[name]`, возвращающий только имена:

```json
[
  [
    "Fred"
  ],
  [
    "Wilma"
  ]
]
```

JMESQuery имеет ряд других интересных функций запросов. Если у вас есть время, изучите [интерактивное руководство](http://jmespath.org/tutorial.html), доступное на сайте [JMESPath.org](http://jmespath.org/).

## <a name="filtering-our-azure-cli-queries"></a>Фильтрация запросов Azure CLI

Имея базовое представление о запросах JMES, добавим фильтры к данным, возвращаемым запросами, такими как команда `vm show`. Например, можно получить имя администратора:

```azurecli
az vm show --resource-group ExerciseResources --name SampleVM --query "osProfile.adminUsername"
```

Можно получить размер, назначенный виртуальной машине:

```azurecli
az vm show --resource-group ExerciseResources --name SampleVM --query hardwareProfile.vmSize
```

Чтобы получить все идентификаторы сетевых интерфейсов, используется запрос:

```azurecli
az vm show --resource-group ExerciseResources --name SampleVM --query "networkProfile.networkInterfaces[].id"
```

Этот метод запросов будет работать с любой командой Azure CLI и может использоваться для извлечения определенных фрагментов данных с помощью командной строки. Он полезен при написании сценариев: например, можно извлечь значение из учетной записи Azure и сохранить его в переменной среды или сценария. Если вы решили применять его таким образом, рекомендуется добавить параметр `--output tsv` (сокращаемый до `-o tsv`). В этом случае возвращаются значения, разделенные табуляцией, включающие только фактические значения данных с разделителями-табуляцией.

Например,

```azurecli
az vm show --resource-group ExerciseResources --name SampleVM --query "networkProfile.networkInterfaces[].id" -o tsv
```

возвращает текст: `/subscriptions/abc13b0c-d2c4-64b2-9ac5-2f4cb819b752/resourceGroups/ExerciseResources/providers/Microsoft.Network/networkInterfaces/SampleVMVMNic`
