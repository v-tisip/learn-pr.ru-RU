Azure CLI содержит команду `vm` для работы с виртуальными машинами в Azure. Мы можем передать несколько подкоманд для выполнения определенных задач. Наиболее распространенные подкоманды:

| Подкоманда | ОПИСАНИЕ |
|-------------|-------------|
| `create`    | Создание новой виртуальной машины |
| `deallocate` | Освобождение виртуальной машины |
| `delete` | Удаление виртуальной машины |
| `list` | Вывод списка созданных виртуальных машин в подписке |
| `open-port` | Открытие определенного сетевого порта для входящего трафика |
| `restart` | Перезапуск виртуальной машины |
| `show` | Получение сведений для виртуальной машины |
| `start` | Запуск остановленной виртуальной машины |
| `stop` | Остановка запущенной виртуальной машины |
| `update` | Обновление свойства виртуальной машины |

> [!NOTE]
> Полный список команд см. в [справочной документации по Azure CLI](https://docs.microsoft.com/cli/azure/reference-index?view=azure-cli-latest).

Давайте начнем с первой: `az vm create`. Эта команда используется для создания виртуальной машины в группе ресурсов. Вы можете передать несколько параметров, чтобы настроить все аспекты новой виртуальной машины. Три обязательных параметра:

| Параметр | ОПИСАНИЕ |
|-----------|-------------|
| `resource-group` | Группа ресурсов, которой будет принадлежать виртуальная машина |
| `name` | Имя виртуальной машины — должно быть уникальным в пределах группы ресурсов |
| `image` | Образ операционной системы для создания виртуальной машины |

Кроме того, полезно добавить флаг `--verbose`, чтобы смотреть ход выполнения при создании виртуальной машины. 

## <a name="create-a-linux-virtual-machine"></a>Создание виртуальной машины Linux

Давайте создадим новую виртуальную машину Linux. В Azure Cloud Shell введите следующую команду:

```azurecli
az vm create --resource-group ExerciseResources --name SampleVM --image Debian --admin-username aldis --generate-ssh-keys --verbose 
```

Эта команда создаст новую виртуальную машину Linux **Debian** с именем `SampleVM`. Обратите внимание на то, что средство интерфейса командной строки Azure блокируется при создании виртуальной машины. Если вы не хотите ждать, можно использовать параметр `--no-wait`, чтобы средство интерфейса командной строки Azure выполнило возврат немедленно, например, если вы выполняете команду в скрипте. Далее в скрипте используйте команду `azure vm wait --name [vm-name]`, чтобы дождаться завершения создания виртуальной машины.

Если взглянуть на подробные ответы, вы также увидите, что имя `SampleVM` используется для именования различных зависимостей для виртуальной машины.

```
Succeeded: SampleVMNSG (Microsoft.Network/networkSecurityGroups)
Accepted: SampleVMVNET (Microsoft.Network/virtualNetworks)
Succeeded: SampleVMPublicIP (Microsoft.Network/publicIPAddresses)
Accepted: SampleVMVNET (Microsoft.Network/virtualNetworks)
Succeeded: SampleVMVNET (Microsoft.Network/virtualNetworks)
Accepted: vm_deploy_vzKnQDyyq48yPUO4VrSDfFIi81vHKZ9g (Microsoft.Resources/deployments)
```

Вы можете переопределить эти автоматически созданные имена ресурсов, используя дополнительные параметры для `vm create`, такие как `--vnet-name` и `--public-ip-address-dns-name`.

Обратите внимание на то, что мы указываем имя учетной записи администратора через флаг `admin-username`, чтобы получить "aldis". Если опустить это, команда `vm create` будет использовать ваше _действующие имя пользователя_. Поскольку правила для имен учетных записей отличаются для каждой ОС, лучше указать определенное имя. Общие имена, например "root" и "admin", запрещены для большинства образов.

Мы также используем флаг `generate-ssh-keys`. Этот параметр используется для дистрибутивов Linux и создает пару ключей безопасности, чтобы мы могли использовать средство `ssh` для удаленного доступа к виртуальной машине. Два файла помещаются в папку `.ssh` на вашем компьютере и на виртуальной машине. Если у вас уже есть ключ SSH с именем `id_rsa` в целевой папке, то он будет использоваться вместо создания нового ключа.

По завершении создания виртуальной машины вы получите ответ JSON, который включает в себя текущее состояние виртуальной машины и ее общедоступные и частные IP-адреса, назначенные Azure:

```json
{
  "fqdns": "",
  "id": "/subscriptions/abc13b0c-d2c4-64b2-9ac5-2f4cb819b752/resourceGroups/ExerciseResources/providers/Microsoft.Compute/virtualMachines/SampleVM",
  "location": "eastus",
  "macAddress": "00-0D-3A-1A-D9-74",
  "powerState": "VM running",
  "privateIpAddress": "10.0.0.4",
  "publicIpAddress": "168.61.54.62",
  "resourceGroup": "ExerciseResources",
  "zones": ""
}
```

